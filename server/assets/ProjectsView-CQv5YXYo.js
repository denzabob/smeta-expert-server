import{W as B,r as u,C as F,D as a,G as l,aW as s,a1 as C,a$ as M,F as q}from"./vendor-BQXrruHR.js";import{f as I,d as V,i as y,w,c as i,p as N,q as j,h as k,j as W,a as A,b as m,m as E,x as G}from"./index-B_oQPGco.js";const H=B({__name:"ProjectsView",setup(R){const p=M(),v=u([]),f=u(!1),r=u(!1),c=u(!1),d=u(!1),n=u({number:"",expert_name:"",address:"",waste_coefficient:1.2,repair_coefficient:1}),x=[{title:"№ дела",key:"number"},{title:"Эксперт",key:"expert_name"},{title:"Адрес",key:"address"},{title:"Действия",key:"actions",sortable:!1}],g=({item:o})=>({onClick:()=>P(o),style:{cursor:"pointer"}}),b=async()=>{f.value=!0;try{v.value=(await V.get("/api/projects")).data}catch(o){console.error("Ошибка загрузки проектов:",o)}finally{f.value=!1}},_=async()=>{d.value=!0;try{const e=(await V.post("/api/projects",n.value)).data.id;r.value=!1,p.push(`/projects/${e}/edit`)}catch(o){console.error("Ошибка создания проекта:",o),alert("Не удалось создать проект")}finally{d.value=!1}},$=()=>{r.value=!0,n.value={number:"",expert_name:"",address:"",waste_coefficient:1.2,repair_coefficient:1}},P=o=>{p.push(`/projects/${o.id}/edit`)},U=o=>{p.push(`/projects/${o.id}/edit`)},T=async o=>{if(confirm(`Удалить проект "${o.number}"?`))try{await V.delete(`/api/projects/${o.id}`),b()}catch(e){console.error("Ошибка удаления:",e),alert("Не удалось удалить проект")}};return b(),(o,e)=>(q(),F(I,null,{default:a(()=>[l(k,null,{default:a(()=>[l(y,null,{default:a(()=>[...e[8]||(e[8]=[s("Проекты",-1)])]),_:1}),l(w,null,{default:a(()=>[l(i,{"prepend-icon":"mdi-plus",onClick:$},{default:a(()=>[...e[9]||(e[9]=[s("Новый проект",-1)])]),_:1})]),_:1}),l(N,{headers:x,items:v.value,loading:f.value,"row-props":g,"item-value":"id"},{"item.actions":a(({item:t})=>[l(i,{icon:"",onClick:C(D=>U(t),["stop"])},{default:a(()=>[l(j,null,{default:a(()=>[...e[10]||(e[10]=[s("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"]),l(i,{icon:"",onClick:C(D=>T(t),["stop"])},{default:a(()=>[l(j,null,{default:a(()=>[...e[11]||(e[11]=[s("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1},8,["items","loading"])]),_:1}),l(G,{modelValue:r.value,"onUpdate:modelValue":e[7]||(e[7]=t=>r.value=t),"max-width":"600"},{default:a(()=>[l(k,null,{default:a(()=>[l(y,null,{default:a(()=>[...e[12]||(e[12]=[s("Новый проект",-1)])]),_:1}),l(W,null,{default:a(()=>[l(A,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t)},{default:a(()=>[l(m,{modelValue:n.value.number,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.number=t),label:"№ дела",required:""},null,8,["modelValue"]),l(m,{modelValue:n.value.expert_name,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.expert_name=t),label:"ФИО эксперта"},null,8,["modelValue"]),l(m,{modelValue:n.value.address,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.address=t),label:"Адрес объекта"},null,8,["modelValue"]),l(m,{modelValue:n.value.waste_coefficient,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.waste_coefficient=t),modelModifiers:{number:!0},label:"Коэффициент обрезков",type:"number",step:"0.01",min:"1"},null,8,["modelValue"]),l(m,{modelValue:n.value.repair_coefficient,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.repair_coefficient=t),modelModifiers:{number:!0},label:"Ремонтный коэффициент",type:"number",step:"0.01",min:"1"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(w,null,{default:a(()=>[l(E),l(i,{onClick:e[6]||(e[6]=t=>r.value=!1),disabled:d.value},{default:a(()=>[...e[13]||(e[13]=[s("Отмена",-1)])]),_:1},8,["disabled"]),l(i,{color:"primary",onClick:_,loading:d.value,disabled:!n.value.number||d.value},{default:a(()=>[...e[14]||(e[14]=[s(" Создать ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{H as default};

import{W as Xe,r as f,d as S,w as Ye,X as Ge,C as _,D as t,G as l,z as u,aY as o,a0 as P,$ as c,a4 as M,a3 as U,a2 as i,F as n,a1 as Je,A as te}from"./vendor-Cpjz-SYi.js";import{f as Ze,d as $,g as d,k as g,$ as D,Y as Qe,a0 as E,h as y,i as w,q as m,m as I,c as x,j as b,o as ae,t as se,S as he,V as j,w as A,C as fe,b as O,H as el,N as ll,a3 as q,s as B,A as pe,Z as tl,T as al,U as sl,W as ol,r as ul,D as ce,E as ye,X as _e,I as rl,a4 as il,_ as nl}from"./index-DvMw0XIj.js";const dl=["href"],ml={class:"text-body-2 text-medium-emphasis mb-3"},vl={class:"d-flex align-center justify-space-between"},fl={class:"text-subtitle-2 mb-2"},pl={class:"d-flex flex-wrap ga-2"},cl={class:"text-subtitle-1 font-weight-medium mb-2"},yl={key:0},_l={class:"preview-text"},bl={class:"text-h5 font-weight-bold"},gl={class:"text-h5 font-weight-bold"},xl={class:"text-h5 font-weight-bold"},Vl={class:"text-h5 font-weight-bold"},kl={class:"activity-chart"},wl={class:"activity-bar-wrapper"},Cl=["title"],Ll=["title"],Pl={class:"activity-label"},Ml={class:"d-flex justify-center mt-2"},Ul={class:"hourly-chart"},$l=["title"],zl={key:0,class:"hourly-label"},Tl={class:"text-caption"},Sl={class:"provider-pie-chart mt-4"},Fl={class:"pie-chart"},Il={viewBox:"0 0 100 100"},Ol=["stroke","stroke-dasharray","stroke-dashoffset"],ql={class:"pie-center"},Bl={class:"text-h6"},Dl={class:"text-white font-weight-bold"},El={class:"text-h6 font-weight-bold"},jl={class:"text-body-2"},Al=Xe({__name:"AdminPanelView",setup(Nl){const N=f("llm"),R=f(!1),W=f(!1),K=f(!1),p=f({mode:"auto",primary_provider:"openrouter",fallback_providers:["deepseek"],providers:{},circuit_breaker:{},available_providers:[]}),C=f({}),X=S(()=>p.value.available_providers||[]),z=f(null),be=[{title:"Auto (с failover)",value:"auto"},{title:"Manual (только primary)",value:"manual"}],oe=S(()=>X.value.map(s=>({title:s.title,value:s.value}))),ge=S(()=>oe.value.filter(s=>s.value!==p.value.primary_provider)),xe=S(()=>z.value?Object.values(z.value.results).every(e=>e.available)?"success":"warning":"info");async function Y(){R.value=!0;try{const{data:s}=await $.get("/api/admin/llm-settings");p.value=s;const e=s.available_providers||[],a={};for(const r of e)a[r.value]={api_key:"",base_url:"",model:""};C.value=a}catch(s){console.error("Failed to load LLM settings",s)}finally{R.value=!1}}async function Ve(){W.value=!0;try{const s={mode:p.value.mode,primary_provider:p.value.primary_provider,fallback_providers:p.value.fallback_providers,providers:{}};for(const[e,a]of Object.entries(C.value)){const r={};a.api_key&&(r.api_key=a.api_key),a.base_url&&(r.base_url=a.base_url),a.model&&(r.model=a.model),Object.keys(r).length>0&&(s.providers[e]=r)}await $.put("/api/admin/llm-settings",s),await Y()}catch(s){console.error("Failed to save LLM settings",s)}finally{W.value=!1}}async function ke(){K.value=!0,z.value=null;try{const{data:s}=await $.post("/api/admin/llm-test");z.value=s}catch(s){console.error("Failed to test providers",s)}finally{K.value=!1}}async function we(s){try{await $.post("/api/admin/llm-reset-circuit",{provider:s}),await Y()}catch(e){console.error("Failed to reset circuit breaker",e)}}const T=f(!1),H=f("7d"),v=f({totals:{total_requests:0,successful_requests:0,failed_requests:0,success_rate:0,total_cost:0,total_tokens:0,avg_latency_ms:0,unique_users:0},by_provider:{},by_user:[],daily_activity:[],hourly_activity:[],errors_by_type:[]});async function G(){T.value=!0;try{const{data:s}=await $.get("/api/admin/llm-stats",{params:{period:H.value}});v.value=s}catch(s){console.error("Failed to load stats",s)}finally{T.value=!1}}Ye(H,()=>{G()});const Ce=S(()=>Math.max(1,...v.value.daily_activity.map(s=>s.count))),Le=S(()=>Math.max(1,...v.value.hourly_activity.map(s=>s.count)));function ue(s){const e=s/Ce.value*100;return`${Math.max(2,e)}%`}function Pe(s){const e=s/Le.value*100;return`${Math.max(2,e)}%`}const Me=S(()=>{const s=[];for(let e=0;e<24;e++){const a=v.value.hourly_activity.find(r=>r.hour===e);s.push({hour:e,count:a?.count||0})}return s});function Ue(s){const e=new Date(s);return`${e.getDate()}/${e.getMonth()+1}`}const $e={openrouter:"purple",deepseek:"blue",mistral:"orange"},ze={openrouter:"mdi-cloud",deepseek:"mdi-brain",mistral:"mdi-weather-windy"};function re(s){return $e[s]||"grey"}function Te(s){return ze[s]||"mdi-robot"}function Se(s){return X.value.find(a=>a.value===s)?.title||s}function ie(s){return v.value.totals.total_requests===0?0:Math.round(s/v.value.totals.total_requests*100)}const Fe=S(()=>{const s=v.value.totals.total_requests;if(s===0)return[];const e=2*Math.PI*40;let a=0;const r=[];for(const[ve,We]of Object.entries(v.value.by_provider)){const Ke=We.count/s,le=e*Ke;r.push({color:Ie(ve),dasharray:`${le} ${e-le}`,offset:-a}),a+=le}return r});function Ie(s){return{openrouter:"#9c27b0",deepseek:"#2196f3",mistral:"#ff9800"}[s]||"#9e9e9e"}const ne=["primary","secondary","success","warning","info","error"];function de(s){return ne[s%ne.length]||"primary"}function Oe(s){const e=Math.max(1,...v.value.by_user.map(a=>a.count));return s/e*100}const qe={timeout:"mdi-clock-alert",http_429:"mdi-speedometer",http_5xx:"mdi-server-off",invalid_json:"mdi-code-json",auth:"mdi-key-alert",network:"mdi-wifi-off",unknown:"mdi-help-circle"},Be={timeout:"Таймаут",http_429:"Rate Limit",http_5xx:"Ошибка сервера",invalid_json:"Невалидный JSON",auth:"Ошибка авторизации",network:"Сетевая ошибка",unknown:"Неизвестная ошибка"};function De(s){return qe[s]||"mdi-alert"}function Ee(s){return Be[s]||s}const J=f(!1),Z=f(!1),Q=f(!1),h=f(!1),k=f(""),F=f("success"),ee=f(""),V=f({system_prompt:"",user_prompt_template:""}),me=f({"{title}":"Название позиции сметы","{context}":"Контекст (родительские элементы)","{desired_hours}":"Желаемое количество часов"}),L=f({title:"Монтаж электропроводки в офисном помещении",context:"Раздел: Электромонтажные работы > Подраздел: Внутренние сети",desired_hours:16});async function je(){J.value=!0;try{const{data:s}=await $.get("/api/admin/llm-prompts");s.success&&(V.value.system_prompt=s.prompts.system_prompt,V.value.user_prompt_template=s.prompts.user_prompt_template,me.value=s.available_variables||{})}catch(s){console.error("Failed to load prompts",s),k.value="Ошибка загрузки промптов",F.value="error"}finally{J.value=!1}}async function Ae(){Z.value=!0,k.value="";try{const{data:s}=await $.put("/api/admin/llm-prompts",{system_prompt:V.value.system_prompt,user_prompt_template:V.value.user_prompt_template});s.success?(k.value="Промпты успешно сохранены",F.value="success"):(k.value=s.message||"Ошибка сохранения",F.value="error")}catch(s){console.error("Failed to save prompts",s),k.value=s.response?.data?.message||"Ошибка сохранения промптов",F.value="error"}finally{Z.value=!1}}async function Ne(){if(confirm("Вы уверены, что хотите сбросить промпты к значениям по умолчанию?")){Q.value=!0,k.value="";try{const{data:s}=await $.post("/api/admin/llm-prompts/reset");s.success&&(V.value.system_prompt=s.prompts.system_prompt,V.value.user_prompt_template=s.prompts.user_prompt_template,k.value="Промпты сброшены к значениям по умолчанию",F.value="success")}catch(s){console.error("Failed to reset prompts",s),k.value="Ошибка сброса промптов",F.value="error"}finally{Q.value=!1}}}async function He(){h.value=!0;try{const{data:s}=await $.post("/api/admin/llm-prompts/preview",{user_prompt_template:V.value.user_prompt_template,title:L.value.title,context:L.value.context,desired_hours:L.value.desired_hours});s.success&&(ee.value=s.preview)}catch(s){console.error("Failed to load preview",s)}finally{h.value=!1}}function Re(s){V.value.user_prompt_template+=` ${s}`}return Ge(()=>{Y(),G(),je()}),(s,e)=>(n(),_(Ze,{fluid:""},{default:t(()=>[l(g,{align:"center",class:"mb-6"},{default:t(()=>[l(d,{cols:"12",md:"8"},{default:t(()=>[...e[14]||(e[14]=[u("div",{class:"text-h5 font-weight-medium"},"Админ‑панель",-1),u("div",{class:"text-body-2 text-medium-emphasis"}," Настройки приложения, статистика и управление пользователями. ",-1)])]),_:1})]),_:1}),l(Qe,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=a=>N.value=a),color:"primary",class:"mb-6","align-tabs":"start"},{default:t(()=>[l(D,{value:"llm","prepend-icon":"mdi-robot"},{default:t(()=>[...e[15]||(e[15]=[o("LLM Провайдеры",-1)])]),_:1}),l(D,{value:"llm-prompts","prepend-icon":"mdi-text-box-edit"},{default:t(()=>[...e[16]||(e[16]=[o("Промпты",-1)])]),_:1}),l(D,{value:"llm-stats","prepend-icon":"mdi-chart-line"},{default:t(()=>[...e[17]||(e[17]=[o("LLM Статистика",-1)])]),_:1}),l(D,{value:"settings","prepend-icon":"mdi-cog"},{default:t(()=>[...e[18]||(e[18]=[o("Настройки",-1)])]),_:1}),l(D,{value:"users","prepend-icon":"mdi-account-group"},{default:t(()=>[...e[19]||(e[19]=[o("Пользователи",-1)])]),_:1})]),_:1},8,["modelValue"]),l(tl,{modelValue:N.value,"onUpdate:modelValue":e[13]||(e[13]=a=>N.value=a)},{default:t(()=>[l(E,{value:"llm"},{default:t(()=>[l(g,null,{default:t(()=>[l(d,{cols:"12"},{default:t(()=>[l(y,{loading:R.value},{default:t(()=>[l(w,{class:"d-flex align-center"},{default:t(()=>[l(m,{class:"mr-2"},{default:t(()=>[...e[20]||(e[20]=[o("mdi-robot",-1)])]),_:1}),e[23]||(e[23]=o(" Настройки LLM провайдеров ",-1)),l(I),l(x,{color:"primary",variant:"tonal",size:"small",loading:K.value,onClick:ke},{default:t(()=>[l(m,{start:""},{default:t(()=>[...e[21]||(e[21]=[o("mdi-connection",-1)])]),_:1}),e[22]||(e[22]=o(" Тест подключения ",-1))]),_:1},8,["loading"])]),_:1}),l(b,null,{default:t(()=>[l(g,{class:"mb-4"},{default:t(()=>[l(d,{cols:"12",md:"6"},{default:t(()=>[l(ae,{modelValue:p.value.mode,"onUpdate:modelValue":e[1]||(e[1]=a=>p.value.mode=a),items:be,label:"Режим работы",variant:"outlined",density:"comfortable",hint:"Auto = автоматический failover при ошибках","persistent-hint":""},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"6"},{default:t(()=>[l(ae,{modelValue:p.value.primary_provider,"onUpdate:modelValue":e[2]||(e[2]=a=>p.value.primary_provider=a),items:oe.value,label:"Primary провайдер",variant:"outlined",density:"comfortable"},null,8,["modelValue","items"])]),_:1})]),_:1}),l(g,{class:"mb-4"},{default:t(()=>[l(d,{cols:"12",md:"6"},{default:t(()=>[l(ae,{modelValue:p.value.fallback_providers,"onUpdate:modelValue":e[3]||(e[3]=a=>p.value.fallback_providers=a),items:ge.value,label:"Fallback провайдеры (по приоритету)",variant:"outlined",density:"comfortable",multiple:"",chips:"","closable-chips":"",hint:"Будут использованы при недоступности primary","persistent-hint":""},null,8,["modelValue","items"])]),_:1})]),_:1}),l(se,{class:"my-4"}),e[30]||(e[30]=u("div",{class:"text-subtitle-1 font-weight-medium mb-3"},"Настройки провайдеров",-1)),l(he,{variant:"accordion"},{default:t(()=>[(n(!0),c(U,null,M(X.value,a=>(n(),_(al,{key:a.value},{default:t(()=>[l(sl,null,{default:t(()=>[l(m,{class:"mr-2"},{default:t(()=>[o(i(a.icon),1)]),_:2},1024),o(" "+i(a.title)+" ",1),p.value.providers?.[a.value]?.api_key_set?(n(),_(B,{key:0,color:"success",size:"x-small",class:"ml-2"},{default:t(()=>[...e[24]||(e[24]=[o(" Настроен ",-1)])]),_:1})):p.value.providers?.[a.value]?.is_env_fallback?(n(),_(B,{key:1,color:"warning",size:"x-small",class:"ml-2"},{default:t(()=>[...e[25]||(e[25]=[o(" ENV ",-1)])]),_:1})):(n(),_(B,{key:2,color:"error",size:"x-small",class:"ml-2"},{default:t(()=>[...e[26]||(e[26]=[o(" Не настроен ",-1)])]),_:1})),l(I),a.docs_url?(n(),c("a",{key:3,href:a.docs_url,target:"_blank",class:"text-caption mr-2",onClick:e[4]||(e[4]=Je(()=>{},["stop"]))}," Документация ",8,dl)):P("",!0)]),_:2},1024),l(ol,null,{default:t(()=>[u("div",ml,i(a.description),1),C.value[a.value]?(n(),_(g,{key:0},{default:t(()=>[l(d,{cols:"12",md:"6"},{default:t(()=>[l(O,{modelValue:C.value[a.value].api_key,"onUpdate:modelValue":r=>C.value[a.value].api_key=r,label:"API Key",variant:"outlined",density:"comfortable",type:"password",placeholder:p.value.providers?.[a.value]?.api_key_masked||"Введите ключ",hint:"Оставьте пустым, чтобы сохранить текущий","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024),l(d,{cols:"12",md:"6"},{default:t(()=>[l(O,{modelValue:C.value[a.value].model,"onUpdate:modelValue":r=>C.value[a.value].model=r,label:"Модель",variant:"outlined",density:"comfortable",placeholder:p.value.providers?.[a.value]?.model},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024),l(d,{cols:"12"},{default:t(()=>[l(O,{modelValue:C.value[a.value].base_url,"onUpdate:modelValue":r=>C.value[a.value].base_url=r,label:"Base URL",variant:"outlined",density:"comfortable",placeholder:p.value.providers?.[a.value]?.base_url},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024)]),_:2},1024)):P("",!0),p.value.circuit_breaker?.[a.value]?.status==="down"?(n(),_(j,{key:1,type:"error",variant:"tonal",class:"mt-3"},{default:t(()=>[u("div",vl,[u("div",null,[e[27]||(e[27]=u("strong",null,"Circuit Breaker OPEN",-1)),e[28]||(e[28]=u("br",null,null,-1)),o(" Провайдер временно отключен до "+i(p.value.circuit_breaker?.[a.value]?.down_until),1)]),l(x,{color:"error",variant:"outlined",size:"small",onClick:r=>we(a.value)},{default:t(()=>[...e[29]||(e[29]=[o(" Сбросить ",-1)])]),_:1},8,["onClick"])])]),_:2},1024)):P("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1}),z.value?(n(),_(j,{key:0,type:xe.value,variant:"tonal",class:"mt-4",closable:"","onClick:close":e[5]||(e[5]=a=>z.value=null)},{default:t(()=>[u("div",fl,"Результаты теста ("+i(z.value.tested_at)+")",1),(n(!0),c(U,null,M(z.value.results,(a,r)=>(n(),c("div",{key:r,class:"mb-1"},[l(m,{color:a.available?"success":"error",size:"small"},{default:t(()=>[o(i(a.available?"mdi-check-circle":"mdi-alert-circle"),1)]),_:2},1032,["color"]),u("strong",null,i(r),1),o(": "+i(a.available?`OK (${a.latency_ms}ms)`:a.error),1)]))),128))]),_:1},8,["type"])):P("",!0)]),_:1}),l(A,null,{default:t(()=>[l(I),l(x,{color:"primary",variant:"elevated",loading:W.value,onClick:Ve},{default:t(()=>[l(m,{start:""},{default:t(()=>[...e[31]||(e[31]=[o("mdi-content-save",-1)])]),_:1}),e[32]||(e[32]=o(" Сохранить ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),l(E,{value:"llm-prompts"},{default:t(()=>[l(g,null,{default:t(()=>[l(d,{cols:"12"},{default:t(()=>[l(y,{loading:J.value},{default:t(()=>[l(w,{class:"d-flex align-center"},{default:t(()=>[l(m,{class:"mr-2"},{default:t(()=>[...e[33]||(e[33]=[o("mdi-text-box-edit",-1)])]),_:1}),e[36]||(e[36]=o(" Настройка промптов для LLM ",-1)),l(I),l(x,{color:"warning",variant:"tonal",size:"small",loading:Q.value,onClick:Ne},{default:t(()=>[l(m,{start:""},{default:t(()=>[...e[34]||(e[34]=[o("mdi-restore",-1)])]),_:1}),e[35]||(e[35]=o(" Сбросить по умолчанию ",-1))]),_:1},8,["loading"])]),_:1}),l(b,null,{default:t(()=>[e[43]||(e[43]=u("div",{class:"text-subtitle-1 font-weight-medium mb-2"}," Системный промпт ",-1)),e[44]||(e[44]=u("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Задаёт роль и поведение модели. Этот промпт отправляется в начале каждого запроса. ",-1)),l(fe,{modelValue:V.value.system_prompt,"onUpdate:modelValue":e[6]||(e[6]=a=>V.value.system_prompt=a),variant:"outlined",rows:"8",placeholder:"Вы - эксперт по декомпозиции работ...","auto-grow":"",counter:"",maxlength:"10000"},null,8,["modelValue"]),l(se,{class:"my-6"}),e[45]||(e[45]=u("div",{class:"text-subtitle-1 font-weight-medium mb-2"}," Шаблон пользовательского промпта ",-1)),e[46]||(e[46]=u("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Шаблон запроса пользователя. Используйте переменные для динамических данных. ",-1)),l(j,{type:"info",variant:"tonal",class:"mb-3",density:"compact"},{default:t(()=>[e[37]||(e[37]=u("div",{class:"text-subtitle-2 mb-1"},"Доступные переменные:",-1)),u("div",pl,[(n(!0),c(U,null,M(me.value,(a,r)=>(n(),_(B,{key:r,size:"small",color:"info",variant:"outlined",onClick:ve=>Re(r)},{default:t(()=>[u("code",null,i(r),1),l(ul,{activator:"parent",location:"top"},{default:t(()=>[o(i(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))])]),_:1}),l(fe,{modelValue:V.value.user_prompt_template,"onUpdate:modelValue":e[7]||(e[7]=a=>V.value.user_prompt_template=a),variant:"outlined",rows:"6",placeholder:"Разбей работу {title} на подзадачи...","auto-grow":"",counter:"",maxlength:"5000"},null,8,["modelValue"]),l(se,{class:"my-6"}),u("div",cl,[l(m,{class:"mr-1"},{default:t(()=>[...e[38]||(e[38]=[o("mdi-eye",-1)])]),_:1}),e[39]||(e[39]=o(" Предпросмотр ",-1))]),e[47]||(e[47]=u("div",{class:"text-body-2 text-medium-emphasis mb-3"}," Посмотрите, как будет выглядеть промпт с примерными данными. ",-1)),l(g,{class:"mb-3"},{default:t(()=>[l(d,{cols:"12",md:"4"},{default:t(()=>[l(O,{modelValue:L.value.title,"onUpdate:modelValue":e[8]||(e[8]=a=>L.value.title=a),label:"Пример: название работы",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"4"},{default:t(()=>[l(O,{modelValue:L.value.context,"onUpdate:modelValue":e[9]||(e[9]=a=>L.value.context=a),label:"Пример: контекст",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"2"},{default:t(()=>[l(O,{modelValue:L.value.desired_hours,"onUpdate:modelValue":e[10]||(e[10]=a=>L.value.desired_hours=a),modelModifiers:{number:!0},label:"Часов",variant:"outlined",density:"compact",type:"number",min:"0.1",max:"1000"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[l(x,{color:"secondary",variant:"tonal",loading:h.value,onClick:He,block:""},{default:t(()=>[l(m,{start:""},{default:t(()=>[...e[40]||(e[40]=[o("mdi-eye-refresh",-1)])]),_:1}),e[41]||(e[41]=o(" Показать ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),l(el,null,{default:t(()=>[ee.value?(n(),c("div",yl,[l(y,{variant:"outlined",color:"grey-lighten-4",class:"pa-3"},{default:t(()=>[e[42]||(e[42]=u("div",{class:"text-caption text-medium-emphasis mb-1"}," Результат рендеринга шаблона: ",-1)),u("pre",_l,i(ee.value),1)]),_:1})])):P("",!0)]),_:1}),k.value?(n(),_(j,{key:0,type:F.value,variant:"tonal",class:"mt-4",closable:"","onClick:close":e[11]||(e[11]=a=>k.value="")},{default:t(()=>[o(i(k.value),1)]),_:1},8,["type"])):P("",!0)]),_:1}),l(A,null,{default:t(()=>[l(I),l(x,{color:"primary",variant:"elevated",loading:Z.value,onClick:Ae},{default:t(()=>[l(m,{start:""},{default:t(()=>[...e[48]||(e[48]=[o("mdi-content-save",-1)])]),_:1}),e[49]||(e[49]=o(" Сохранить промпты ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),l(E,{value:"llm-stats"},{default:t(()=>[l(g,{class:"mb-4"},{default:t(()=>[l(d,{cols:"12",class:"d-flex align-center"},{default:t(()=>[l(ll,{modelValue:H.value,"onUpdate:modelValue":e[12]||(e[12]=a=>H.value=a),mandatory:"",color:"primary",density:"comfortable"},{default:t(()=>[l(x,{value:"24h"},{default:t(()=>[...e[50]||(e[50]=[o("24 часа",-1)])]),_:1}),l(x,{value:"7d"},{default:t(()=>[...e[51]||(e[51]=[o("7 дней",-1)])]),_:1}),l(x,{value:"30d"},{default:t(()=>[...e[52]||(e[52]=[o("30 дней",-1)])]),_:1}),l(x,{value:"90d"},{default:t(()=>[...e[53]||(e[53]=[o("90 дней",-1)])]),_:1})]),_:1},8,["modelValue"]),l(I),l(x,{color:"primary",variant:"tonal",size:"small",loading:T.value,onClick:G},{default:t(()=>[l(m,{start:""},{default:t(()=>[...e[54]||(e[54]=[o("mdi-refresh",-1)])]),_:1}),e[55]||(e[55]=o(" Обновить ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),l(g,{class:"mb-4"},{default:t(()=>[l(d,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l(y,{color:"primary",variant:"tonal"},{default:t(()=>[l(b,{class:"d-flex align-center"},{default:t(()=>[l(q,{color:"primary",class:"mr-4"},{default:t(()=>[l(m,null,{default:t(()=>[...e[56]||(e[56]=[o("mdi-message-processing",-1)])]),_:1})]),_:1}),u("div",null,[u("div",bl,i(v.value.totals.total_requests),1),e[57]||(e[57]=u("div",{class:"text-body-2"},"Всего запросов",-1))])]),_:1})]),_:1})]),_:1}),l(d,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l(y,{color:"success",variant:"tonal"},{default:t(()=>[l(b,{class:"d-flex align-center"},{default:t(()=>[l(q,{color:"success",class:"mr-4"},{default:t(()=>[l(m,null,{default:t(()=>[...e[58]||(e[58]=[o("mdi-check-circle",-1)])]),_:1})]),_:1}),u("div",null,[u("div",gl,i(v.value.totals.success_rate)+"%",1),e[59]||(e[59]=u("div",{class:"text-body-2"},"Успешность",-1))])]),_:1})]),_:1})]),_:1}),l(d,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l(y,{color:"warning",variant:"tonal"},{default:t(()=>[l(b,{class:"d-flex align-center"},{default:t(()=>[l(q,{color:"warning",class:"mr-4"},{default:t(()=>[l(m,null,{default:t(()=>[...e[60]||(e[60]=[o("mdi-currency-usd",-1)])]),_:1})]),_:1}),u("div",null,[u("div",xl,"$"+i(v.value.totals.total_cost),1),e[61]||(e[61]=u("div",{class:"text-body-2"},"Затраты",-1))])]),_:1})]),_:1})]),_:1}),l(d,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l(y,{color:"info",variant:"tonal"},{default:t(()=>[l(b,{class:"d-flex align-center"},{default:t(()=>[l(q,{color:"info",class:"mr-4"},{default:t(()=>[l(m,null,{default:t(()=>[...e[62]||(e[62]=[o("mdi-account-multiple",-1)])]),_:1})]),_:1}),u("div",null,[u("div",Vl,i(v.value.totals.unique_users),1),e[63]||(e[63]=u("div",{class:"text-body-2"},"Активных пользователей",-1))])]),_:1})]),_:1})]),_:1})]),_:1}),l(g,null,{default:t(()=>[l(d,{cols:"12",lg:"8"},{default:t(()=>[l(y,{loading:T.value},{default:t(()=>[l(w,null,{default:t(()=>[l(m,{class:"mr-2"},{default:t(()=>[...e[64]||(e[64]=[o("mdi-chart-line",-1)])]),_:1}),e[65]||(e[65]=o(" Активность по дням ",-1))]),_:1}),l(b,null,{default:t(()=>[u("div",kl,[(n(!0),c(U,null,M(v.value.daily_activity,a=>(n(),c("div",{key:a.date,class:"activity-bar-container"},[u("div",wl,[u("div",{class:"activity-bar activity-bar-success",style:te({height:ue(a.successful)}),title:`Успешных: ${a.successful}`},null,12,Cl),u("div",{class:"activity-bar activity-bar-error",style:te({height:ue(a.failed)}),title:`Ошибок: ${a.failed}`},null,12,Ll)]),u("div",Pl,i(Ue(a.date)),1)]))),128))]),u("div",Ml,[l(B,{size:"small",color:"success",variant:"flat",class:"mr-2"},{default:t(()=>[l(m,{start:"",size:"small"},{default:t(()=>[...e[66]||(e[66]=[o("mdi-circle",-1)])]),_:1}),e[67]||(e[67]=o(" Успешных ",-1))]),_:1}),l(B,{size:"small",color:"error",variant:"flat"},{default:t(()=>[l(m,{start:"",size:"small"},{default:t(()=>[...e[68]||(e[68]=[o("mdi-circle",-1)])]),_:1}),e[69]||(e[69]=o(" Ошибок ",-1))]),_:1})])]),_:1})]),_:1},8,["loading"])]),_:1}),l(d,{cols:"12",lg:"4"},{default:t(()=>[l(y,{loading:T.value},{default:t(()=>[l(w,null,{default:t(()=>[l(m,{class:"mr-2"},{default:t(()=>[...e[70]||(e[70]=[o("mdi-clock-outline",-1)])]),_:1}),e[71]||(e[71]=o(" Сегодня по часам ",-1))]),_:1}),l(b,null,{default:t(()=>[u("div",Ul,[(n(!0),c(U,null,M(Me.value,a=>(n(),c("div",{key:a.hour,class:"hourly-bar-container"},[u("div",{class:"hourly-bar",style:te({height:Pe(a.count)}),title:`${a.hour}:00 - ${a.count} запросов`},null,12,$l),a.hour%4===0?(n(),c("div",zl,i(a.hour),1)):P("",!0)]))),128))])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),l(g,{class:"mt-4"},{default:t(()=>[l(d,{cols:"12",md:"6"},{default:t(()=>[l(y,{loading:T.value},{default:t(()=>[l(w,null,{default:t(()=>[l(m,{class:"mr-2"},{default:t(()=>[...e[72]||(e[72]=[o("mdi-server",-1)])]),_:1}),e[73]||(e[73]=o(" Статистика провайдеров ",-1))]),_:1}),l(b,null,{default:t(()=>[l(pe,{density:"compact"},{default:t(()=>[(n(!0),c(U,null,M(v.value.by_provider,(a,r)=>(n(),_(ce,{key:r,class:"px-0"},{prepend:t(()=>[l(q,{size:"40",color:re(r)},{default:t(()=>[l(m,null,{default:t(()=>[o(i(Te(r)),1)]),_:2},1024)]),_:2},1032,["color"])]),append:t(()=>[l(rl,{"model-value":ie(a.count),size:40,width:4,color:re(r)},{default:t(()=>[u("span",Tl,i(ie(a.count))+"%",1)]),_:2},1032,["model-value","color"])]),default:t(()=>[l(ye,{class:"font-weight-medium"},{default:t(()=>[o(i(Se(r)),1)]),_:2},1024),l(_e,null,{default:t(()=>[o(i(a.count)+" запросов · $"+i(a.cost)+" · "+i(a.avg_latency_ms)+"ms ",1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),u("div",Sl,[u("div",Fl,[(n(),c("svg",Il,[(n(!0),c(U,null,M(Fe.value,(a,r)=>(n(),c("circle",{key:r,cx:"50",cy:"50",r:"40",fill:"transparent",stroke:a.color,"stroke-width":"20","stroke-dasharray":a.dasharray,"stroke-dashoffset":a.offset,transform:"rotate(-90 50 50)"},null,8,Ol))),128))])),u("div",ql,[u("div",Bl,i(v.value.totals.total_requests),1),e[74]||(e[74]=u("div",{class:"text-caption"},"запросов",-1))])])])]),_:1})]),_:1},8,["loading"])]),_:1}),l(d,{cols:"12",md:"6"},{default:t(()=>[l(y,{loading:T.value},{default:t(()=>[l(w,null,{default:t(()=>[l(m,{class:"mr-2"},{default:t(()=>[...e[75]||(e[75]=[o("mdi-account-star",-1)])]),_:1}),e[76]||(e[76]=o(" Топ пользователей ",-1))]),_:1}),l(b,null,{default:t(()=>[l(pe,{density:"compact"},{default:t(()=>[(n(!0),c(U,null,M(v.value.by_user,(a,r)=>(n(),_(ce,{key:a.user_id,class:"px-0"},{prepend:t(()=>[l(q,{size:"40",color:de(r)},{default:t(()=>[u("span",Dl,i(r+1),1)]),_:2},1032,["color"])]),append:t(()=>[l(il,{"model-value":Oe(a.count),height:"8",rounded:"",color:de(r),class:"ml-4",style:{width:"80px"}},null,8,["model-value","color"])]),default:t(()=>[l(ye,{class:"font-weight-medium"},{default:t(()=>[o(i(a.name),1)]),_:2},1024),l(_e,null,{default:t(()=>[o(i(a.count)+" запросов · $"+i(a.cost),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),v.value.by_user.length===0?(n(),_(j,{key:0,type:"info",variant:"tonal",class:"mt-2"},{default:t(()=>[...e[77]||(e[77]=[o(" Нет данных за выбранный период ",-1)])]),_:1})):P("",!0)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),v.value.errors_by_type.length>0?(n(),_(g,{key:0,class:"mt-4"},{default:t(()=>[l(d,{cols:"12"},{default:t(()=>[l(y,{loading:T.value},{default:t(()=>[l(w,null,{default:t(()=>[l(m,{class:"mr-2",color:"error"},{default:t(()=>[...e[78]||(e[78]=[o("mdi-alert-circle",-1)])]),_:1}),e[79]||(e[79]=o(" Ошибки по типам ",-1))]),_:1}),l(b,null,{default:t(()=>[l(g,null,{default:t(()=>[(n(!0),c(U,null,M(v.value.errors_by_type,a=>(n(),_(d,{key:a.type,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[l(y,{variant:"outlined",color:"error"},{default:t(()=>[l(b,{class:"d-flex align-center"},{default:t(()=>[l(m,{color:"error",class:"mr-3"},{default:t(()=>[o(i(De(a.type)),1)]),_:2},1024),u("div",null,[u("div",El,i(a.count),1),u("div",jl,i(Ee(a.type)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1})):P("",!0)]),_:1}),l(E,{value:"settings"},{default:t(()=>[l(g,null,{default:t(()=>[l(d,{cols:"12",md:"6"},{default:t(()=>[l(y,{class:"h-100"},{default:t(()=>[l(w,null,{default:t(()=>[...e[80]||(e[80]=[o("Настройки приложения",-1)])]),_:1}),l(b,{class:"text-body-2 text-medium-emphasis"},{default:t(()=>[...e[81]||(e[81]=[o(" Здесь будут глобальные параметры, системные флаги и конфигурация модулей. ",-1)])]),_:1}),l(A,null,{default:t(()=>[l(x,{color:"primary",variant:"tonal",disabled:""},{default:t(()=>[...e[82]||(e[82]=[o("Открыть",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(d,{cols:"12",md:"6"},{default:t(()=>[l(y,{class:"h-100"},{default:t(()=>[l(w,null,{default:t(()=>[...e[83]||(e[83]=[o("Безопасность",-1)])]),_:1}),l(b,{class:"text-body-2 text-medium-emphasis"},{default:t(()=>[...e[84]||(e[84]=[o(" Политики доступа, журналы действий и ограничения по ролям. ",-1)])]),_:1}),l(A,null,{default:t(()=>[l(x,{color:"primary",variant:"tonal",disabled:""},{default:t(()=>[...e[85]||(e[85]=[o("Настроить",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(E,{value:"users"},{default:t(()=>[l(y,null,{default:t(()=>[l(w,null,{default:t(()=>[...e[86]||(e[86]=[o("Управление пользователями",-1)])]),_:1}),l(b,{class:"text-body-2 text-medium-emphasis"},{default:t(()=>[...e[87]||(e[87]=[o(" Таблица пользователей, роли, блокировки и сброс паролей будут здесь. ",-1)])]),_:1}),l(A,null,{default:t(()=>[l(x,{color:"primary",variant:"tonal",disabled:""},{default:t(()=>[...e[88]||(e[88]=[o("Добавить пользователя",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Wl=nl(Al,[["__scopeId","data-v-d77259db"]]);export{Wl as default};

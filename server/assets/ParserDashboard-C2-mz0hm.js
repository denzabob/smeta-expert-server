import{be as q,r as v,ac as E,a6 as G,C as x,D as t,G as a,z as n,aB as i,bg as k,bh as M,a9 as K,bi as m,bk as Q,F as _,B as W,bj as X}from"./vendor-Cu69IzCA.js";import{R as g,j as y,a as d,i as f,F as Y,b as w,c as D,d as N,e as Z,J as ee,g as F,h as B,t as ae,V as te,o as I,q as se,r as T,S as le,_ as re}from"./index-DCJJdkM3.js";import{f as ne}from"./formatDistanceToNow-B6Nhz5gL.js";import"./en-US-CEnKpqyg.js";const oe={class:"text-h6"},ie={class:"text-subtitle-2"},ue={class:"d-flex align-center"},ce={class:"text-h6"},de={key:0,class:"activity-pulse"},fe={class:"text-caption ml-1"},ve={class:"metric-value"},me={class:"metric-value"},_e={class:"metric-value"},pe={class:"text-h5"},he=q({__name:"ParserDashboard",setup(ge){const p=Q();let r=!1;const c=v(null),S=v([]),u=v({status:!1,suppliers:!1,run:{}}),o=v({open:!1,supplier:"",config:"{}"});let h=null;E(()=>{r=!1,V(),h=window.setInterval(V,1e4)}),G(()=>{r=!0,h&&clearInterval(h)});async function V(){r||await Promise.all([C(),O()])}async function C(){if(!r)try{u.value.status=!0;const e=await g.getSystemStatus();r||(c.value=e)}catch(e){r||console.error("Failed to load system status:",e)}finally{r||(u.value.status=!1)}}async function O(){if(!r)try{u.value.suppliers=!0;const e=await g.getSuppliersHealth();console.log("Suppliers data received:",e),r||(S.value=e)}catch(e){r||console.error("Failed to load suppliers:",e)}finally{r||(u.value.suppliers=!1)}}function P(e){return e.current_pid?"mdi-sync":e.active?e.health_score>=80?"mdi-check-circle":e.health_score>=50?"mdi-alert-circle":"mdi-close-circle":"mdi-pause-circle"}function R(e){return e.current_pid?"primary":e.active?e.health_score>=80?"success":e.health_score>=50?"warning":"error":"grey"}function $(e){return e.current_pid?"card-running":e.active?"":"card-disabled"}function H(e){return e>=80?"success":e>=50?"warning":"error"}function J(e){if(!e)return"Never";try{return ne(new Date(e),{addSuffix:!0})}catch{return"Unknown"}}function z(e){o.value={open:!0,supplier:e,config:"{}"}}function A(e){try{return JSON.parse(e),!0}catch{return"Invalid JSON"}}async function U(){if(!r)try{const e=JSON.parse(o.value.config);u.value.run[o.value.supplier]=!0;const l=await g.createSession(o.value.supplier,e);r||(o.value.open=!1,p.push(`/parser/sessions/${l.id}`))}catch(e){r||(console.error("Failed to start parser:",e),alert("Failed to start parser. Check console for details."))}finally{r||(u.value.run[o.value.supplier]=!1)}}function L(e){p.push(`/parser/history?supplier=${e}`)}function j(e){p.push(`/parser/settings?supplier=${e}`)}return(e,l)=>(_(),x(te,{fluid:"",class:"parser-dashboard"},{default:t(()=>[a(Y,{type:c.value?.scheduler_running?"success":"error",icon:c.value?.scheduler_running?"mdi-check-circle":"mdi-alert-circle",prominent:"",class:"mb-6 system-status-alert"},{default:t(()=>[a(y,{align:"center"},{default:t(()=>[a(d,null,{default:t(()=>[n("div",oe,i(c.value?.scheduler_running?"System Operational":"Scheduler Offline"),1),n("div",ie," Active Sessions: "+i(c.value?.active_sessions||0)+" | 24h Total: "+i(c.value?.total_sessions_24h||0)+" | Health Score: "+i(c.value?.health_score||0)+"% ",1)]),_:1}),a(d,{cols:"auto"},{default:t(()=>[a(f,{icon:"mdi-refresh",variant:"text",onClick:C,loading:u.value.status},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["type","icon"]),a(y,null,{default:t(()=>[(_(!0),k(K,null,M(S.value,s=>(_(),x(d,{key:s.supplier,cols:"12",md:"6",lg:"4"},{default:t(()=>[a(w,{class:W(["supplier-card",$(s)]),elevation:"2"},{default:t(()=>[a(D,{class:"d-flex align-center justify-space-between"},{default:t(()=>[n("div",ue,[a(I,{icon:P(s),color:R(s),class:"mr-2",size:"large"},null,8,["icon","color"]),n("div",null,[n("div",ce,i(s.supplier),1),a(se,{color:s.active?"success":"grey",size:"small",class:"mt-1"},{default:t(()=>[m(i(s.active?"Active":"Disabled"),1)]),_:2},1032,["color"])])]),s.current_pid?(_(),k("div",de,[a(I,{icon:"mdi-circle",color:"primary",size:"small",class:"pulse-icon"}),n("span",fe,"PID: "+i(s.current_pid),1)])):X("",!0)]),_:2},1024),a(T),a(N,null,{default:t(()=>[a(y,{dense:""},{default:t(()=>[a(d,{cols:"12"},{default:t(()=>[l[3]||(l[3]=n("div",{class:"metric-label"},"Health Score (24h)",-1)),a(le,{"model-value":s.health_score,color:H(s.health_score),height:"20",class:"health-bar"},{default:t(()=>[n("strong",null,i(s.health_score)+"%",1)]),_:2},1032,["model-value","color"])]),_:2},1024),a(d,{cols:"6"},{default:t(()=>[l[4]||(l[4]=n("div",{class:"metric-label"},"Last Sync",-1)),n("div",ve,i(J(s.last_sync)),1)]),_:2},1024),a(d,{cols:"6"},{default:t(()=>[l[5]||(l[5]=n("div",{class:"metric-label"},"Success Rate",-1)),n("div",me,i(s.success_rate_24h)+"% ",1)]),_:2},1024),a(d,{cols:"12"},{default:t(()=>[l[6]||(l[6]=n("div",{class:"metric-label"},"Sessions (24h)",-1)),n("div",_e,i(s.sessions_count_24h)+" runs ",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(T),a(F,{class:"px-4 py-3"},{default:t(()=>[a(f,{color:"primary",variant:"elevated","prepend-icon":"mdi-play",onClick:b=>z(s.supplier),disabled:!s.active||!!s.current_pid,loading:u.value.run[s.supplier]},{default:t(()=>[...l[7]||(l[7]=[m(" Run ",-1)])]),_:1},8,["onClick","disabled","loading"]),a(B),a(f,{variant:"text",icon:"mdi-history",onClick:b=>L(s.supplier),title:"View History"},null,8,["onClick"]),a(f,{variant:"text",icon:"mdi-cog",onClick:b=>j(s.supplier),title:"Settings"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1}),a(ae,{modelValue:o.value.open,"onUpdate:modelValue":l[2]||(l[2]=s=>o.value.open=s),"max-width":"600"},{default:t(()=>[a(w,null,{default:t(()=>[a(D,null,{default:t(()=>[n("span",pe,"Run Parser: "+i(o.value.supplier),1)]),_:1}),a(N,null,{default:t(()=>[a(Z,{ref:"runForm"},{default:t(()=>[a(ee,{modelValue:o.value.config,"onUpdate:modelValue":l[0]||(l[0]=s=>o.value.config=s),label:"Configuration (JSON)",placeholder:"{}",rows:"10",variant:"outlined",class:"mono-font",rules:[A]},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),a(F,null,{default:t(()=>[a(B),a(f,{variant:"text",onClick:l[1]||(l[1]=s=>o.value.open=!1)},{default:t(()=>[...l[8]||(l[8]=[m(" Cancel ",-1)])]),_:1}),a(f,{color:"primary",variant:"elevated",onClick:U,loading:u.value.run[o.value.supplier]},{default:t(()=>[...l[9]||(l[9]=[m(" Start ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),be=re(he,[["__scopeId","data-v-fb694d66"]]);export{be as default};

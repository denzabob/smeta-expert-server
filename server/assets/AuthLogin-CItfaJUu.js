import{W as B,r as s,X as $,n as q,$ as N,C as S,a0 as _,G as o,D as r,aY as u,a2 as z,a1 as F,z as V,a7 as M,cj as T,F as x}from"./vendor-Cpjz-SYi.js";import{u as U,V as j,a as D,b as g,c as f,d as k,_ as E}from"./index-Cph0VrJn.js";const I={class:"d-flex justify-space-between align-center mt-2"},L={class:"mt-2"},W=B({__name:"AuthLogin",emits:["forgot","register"],setup(G,{emit:b}){const v=b,C=U(),c=M(),R=T(),l=s({email:"",password:""}),w=s(),d=s(!1),y=s(),m=s(!1),n=s(""),i=s(!1),p={required:t=>!!t&&t.trim()!==""||"Обязательное поле",email:t=>/.+@.+\..+/.test(t)||"Некорректный e-mail"};$(async()=>{await q(),y.value?.focus?.()});const A=async()=>{const{valid:t}=await w.value?.validate()??{valid:!1};if(t){m.value=!0,n.value="";try{await k.get("/sanctum/csrf-cookie"),await k.post("/api/login",{email:l.value.email,password:l.value.password}),await C.checkAuth(!0);const e=R.query.intended,a=typeof e=="string"?e:"";a&&a.startsWith("/")?await c.replace(a):await c.push({name:"home"})}catch{n.value="Неверные учетные данные"}finally{m.value=!1}}};return(t,e)=>(x(),N("div",null,[n.value?(x(),S(j,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-4","onClick:close":e[0]||(e[0]=a=>n.value="")},{default:r(()=>[u(z(n.value),1)]),_:1})):_("",!0),o(D,{ref_key:"formRef",ref:w,modelValue:d.value,"onUpdate:modelValue":e[6]||(e[6]=a=>d.value=a),onSubmit:F(A,["prevent"])},{default:r(()=>[o(g,{ref_key:"emailRef",ref:y,modelValue:l.value.email,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.email=a),label:"E-mail",type:"email",autocomplete:"email",rules:[p.required,p.email]},null,8,["modelValue","rules"]),o(g,{modelValue:l.value.password,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.password=a),label:"Пароль",type:i.value?"text":"password",autocomplete:"current-password",rules:[p.required],"append-inner-icon":i.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[3]||(e[3]=a=>i.value=!i.value)},null,8,["modelValue","type","rules","append-inner-icon"]),V("div",I,[o(f,{variant:"text",size:"small",class:"text-none px-0",onClick:e[4]||(e[4]=a=>v("forgot"))},{default:r(()=>[...e[7]||(e[7]=[u(" Забыли пароль? ",-1)])]),_:1}),o(f,{color:"primary",class:"text-none",loading:m.value,disabled:!d.value,type:"submit"},{default:r(()=>[...e[8]||(e[8]=[u(" Войти ",-1)])]),_:1},8,["loading","disabled"])]),V("div",L,[o(f,{variant:"text",size:"small",class:"text-none px-0",onClick:e[5]||(e[5]=a=>v("register"))},{default:r(()=>[...e[9]||(e[9]=[u(" Нет аккаунта? Зарегистрироваться ",-1)])]),_:1})])]),_:1},8,["modelValue"])]))}}),Y=E(W,[["__scopeId","data-v-17229b50"]]);export{Y as A};

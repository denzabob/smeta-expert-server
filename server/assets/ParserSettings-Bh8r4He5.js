import{W as h,r as m,d as ee,X as le,Y as ae,C as N,D as a,G as l,z as t,aW as n,$ as te,a4 as se,a3 as ne,ck as oe,a2 as u,F as D}from"./vendor-BCQqBE-6.js";import{a5 as S,g as v,q as T,h as k,i as _,t as w,j as V,b as E,c as g,s as I,a6 as ie,a7 as R,k as U,V as $,w as B,m as M,x as O,y as re,f as de,_ as ue}from"./index-B-peKDul.js";const ve={class:"d-flex align-center mb-4"},fe={class:"setting-group mb-6"},ge={class:"mt-2"},me={class:"setting-group"},pe={class:"d-flex gap-2 mt-3"},ce={class:"mt-3"},ye={class:"setting-group mb-6"},be={class:"text-h6"},ke={class:"setting-group mb-6"},_e={class:"text-h6"},we={class:"setting-group"},Ve={class:"text-h6"},Ce={class:"info-box"},xe={class:"info-value"},Pe={class:"info-box"},Se={class:"info-value"},Te={class:"info-box"},Ie={class:"info-value"},Le={class:"info-box"},Ae={class:"info-value"},De=h({__name:"ParserSettings",setup(Ee){let s=!1;const f=m({logs_retention_days:14,logs_per_session_limit:100,heartbeat_timeout:10}),b=m(["127.0.0.1","::1"]),c=m(""),y=m("****************************************"),p=m({total_sessions:0,total_logs:0,database_size:"N/A",last_cleanup:"N/A",scheduler_running:!1,cleanup_last_run:null,pruning_last_run:null}),r=m({saveSettings:!1,saveIPs:!1,regenerateToken:!1,cleanup:!1,pruning:!1}),C=m(!1),x=m(!1),L=m(""),P=m({show:!1,message:"",color:"success"}),G=ee(()=>y.value.length<=8?y.value:y.value.substring(0,4)+"..."+y.value.substring(y.value.length-4));le(()=>{s=!1,H()}),ae(()=>{s=!0});async function H(){if(!s)try{const[i,e]=await Promise.all([S.getSettings(),S.getAllowedIPs()]);s||(f.value=i,b.value=e)}catch{s||d("Failed to load settings","error")}}async function W(){if(!s)try{r.value.saveSettings=!0,await S.updateSettings(f.value),s||d("Settings saved successfully")}catch{s||d("Failed to save settings","error")}finally{s||(r.value.saveSettings=!1)}}async function q(){if(!s)try{r.value.saveIPs=!0,await S.updateAllowedIPs(b.value),s||d("IP whitelist updated successfully")}catch{s||d("Failed to update IP whitelist","error")}finally{s||(r.value.saveIPs=!1)}}async function K(){if(!s)try{r.value.regenerateToken=!0;const{token:i}=await S.regenerateToken();s||(y.value=i,C.value=!1,d("Token regenerated successfully. Copy it to Python config!","warning"))}catch{s||d("Failed to regenerate token","error")}finally{s||(r.value.regenerateToken=!1)}}function z(){if(A(c.value)){if(b.value.includes(c.value)){d("IP already in whitelist","warning");return}b.value.push(c.value),c.value=""}}function Y(i){b.value.splice(i,1)}function j(i){return A(i)||"Invalid IP address"}function A(i){const e=/^(\d{1,3}\.){3}\d{1,3}$/,o=/^([\da-f]{1,4}:){7}[\da-f]{1,4}$/i;return e.test(i)||o.test(i)||i==="::1"}function X(){navigator.clipboard.writeText(y.value),d("Token copied to clipboard")}async function Z(){if(!s)try{r.value.cleanup=!0,s||d("Cleanup completed")}catch{s||d("Cleanup failed","error")}finally{s||(r.value.cleanup=!1)}}async function J(){if(!s)try{r.value.pruning=!0,s||d("Log pruning completed")}catch{s||d("Pruning failed","error")}finally{s||(r.value.pruning=!1)}}async function Q(){if(!s)try{s||(x.value=!1,L.value="",d("All logs deleted","warning"))}catch{s||d("Failed to clear logs","error")}}function d(i,e="success"){s||(P.value={show:!0,message:i,color:e})}return(i,e)=>(D(),N(de,{fluid:"",class:"system-settings"},{default:a(()=>[l(U,null,{default:a(()=>[l(v,{cols:"12"},{default:a(()=>[t("div",ve,[l(T,{icon:"mdi-cog",size:"large",class:"mr-3"}),e[12]||(e[12]=t("div",null,[t("div",{class:"text-h4"},"System Settings"),t("div",{class:"text-subtitle-1 text-grey"}," Security & Configuration Management ")],-1))])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[l(k,{class:"settings-card",elevation:"2"},{default:a(()=>[l(_,{class:"card-header"},{default:a(()=>[l(T,{icon:"mdi-shield-lock",class:"mr-2"}),e[13]||(e[13]=n(" Callback Security ",-1))]),_:1}),l(w),l(V,{class:"pa-6"},{default:a(()=>[t("div",fe,[e[16]||(e[16]=t("div",{class:"setting-label"},"API Callback Token",-1)),e[17]||(e[17]=t("div",{class:"setting-description"}," HMAC-SHA256 token for securing webhook callbacks from Python parser ",-1)),l(E,{"model-value":G.value,readonly:"",variant:"outlined",density:"compact",class:"mt-2","append-icon":"mdi-content-copy","onClick:append":X},null,8,["model-value"]),t("div",ge,[l(g,{color:"warning",variant:"elevated","prepend-icon":"mdi-refresh",onClick:e[0]||(e[0]=o=>C.value=!0),loading:r.value.regenerateToken,size:"small"},{default:a(()=>[...e[14]||(e[14]=[n(" Regenerate Token ",-1)])]),_:1},8,["loading"]),l(I,{size:"small",class:"ml-2",color:"error"},{default:a(()=>[...e[15]||(e[15]=[n(" Requires Python reconfiguration ",-1)])]),_:1})])]),t("div",me,[e[19]||(e[19]=t("div",{class:"setting-label"},"Allowed IP Addresses",-1)),e[20]||(e[20]=t("div",{class:"setting-description"}," Only these IPs can send callbacks to the server. Use 127.0.0.1 for local parser. ",-1)),l(ie,{class:"mt-3"},{default:a(()=>[(D(!0),te(ne,null,se(b.value,(o,F)=>(D(),N(I,{key:F,closable:"","onClick:close":Re=>Y(F),color:"primary",variant:"elevated"},{default:a(()=>[n(u(o),1)]),_:2},1032,["onClick:close"]))),128))]),_:1}),t("div",pe,[l(E,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),label:"New IP Address",placeholder:"127.0.0.1 or ::1",variant:"outlined",density:"compact",class:"flex-grow-1",onKeyup:oe(z,["enter"]),rules:[j]},null,8,["modelValue","rules"]),l(g,{color:"primary",variant:"elevated",icon:"mdi-plus",onClick:z,disabled:!A(c.value)},null,8,["disabled"])]),t("div",ce,[l(g,{color:"success",variant:"elevated","prepend-icon":"mdi-content-save",onClick:q,loading:r.value.saveIPs,size:"small"},{default:a(()=>[...e[18]||(e[18]=[n(" Save IP Whitelist ",-1)])]),_:1},8,["loading"])])])]),_:1})]),_:1})]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[l(k,{class:"settings-card",elevation:"2"},{default:a(()=>[l(_,{class:"card-header"},{default:a(()=>[l(T,{icon:"mdi-database",class:"mr-2"}),e[21]||(e[21]=n(" Log Management ",-1))]),_:1}),l(w),l(V,{class:"pa-6"},{default:a(()=>[t("div",ye,[e[22]||(e[22]=t("div",{class:"setting-label"},"Log Retention Period",-1)),e[23]||(e[23]=t("div",{class:"setting-description"}," Logs older than this will be automatically deleted by the pruner ",-1)),l(R,{modelValue:f.value.logs_retention_days,"onUpdate:modelValue":e[2]||(e[2]=o=>f.value.logs_retention_days=o),min:7,max:90,step:1,"thumb-label":"always",class:"mt-4"},{append:a(()=>[t("span",be,u(f.value.logs_retention_days)+" days",1)]),_:1},8,["modelValue"])]),t("div",ke,[e[24]||(e[24]=t("div",{class:"setting-label"},"Max Logs Per Session",-1)),e[25]||(e[25]=t("div",{class:"setting-description"}," Maximum number of log entries stored per parsing session ",-1)),l(R,{modelValue:f.value.logs_per_session_limit,"onUpdate:modelValue":e[3]||(e[3]=o=>f.value.logs_per_session_limit=o),min:50,max:500,step:10,"thumb-label":"always",class:"mt-4"},{append:a(()=>[t("span",_e,u(f.value.logs_per_session_limit),1)]),_:1},8,["modelValue"])]),t("div",we,[e[26]||(e[26]=t("div",{class:"setting-label"},"Heartbeat Timeout",-1)),e[27]||(e[27]=t("div",{class:"setting-description"}," Auto-fail sessions if no callback received for this duration (minutes) ",-1)),l(R,{modelValue:f.value.heartbeat_timeout,"onUpdate:modelValue":e[4]||(e[4]=o=>f.value.heartbeat_timeout=o),min:5,max:60,step:5,"thumb-label":"always",class:"mt-4"},{append:a(()=>[t("span",Ve,u(f.value.heartbeat_timeout)+" min",1)]),_:1},8,["modelValue"])]),l(w,{class:"my-4"}),l(g,{color:"success",variant:"elevated","prepend-icon":"mdi-content-save",onClick:W,loading:r.value.saveSettings,block:""},{default:a(()=>[...e[28]||(e[28]=[n(" Save Log Settings ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),l(v,{cols:"12"},{default:a(()=>[l(k,{class:"settings-card",elevation:"2"},{default:a(()=>[l(_,{class:"card-header"},{default:a(()=>[l(T,{icon:"mdi-information",class:"mr-2"}),e[29]||(e[29]=n(" System Information ",-1))]),_:1}),l(w),l(V,{class:"pa-6"},{default:a(()=>[l(U,null,{default:a(()=>[l(v,{cols:"12",md:"3"},{default:a(()=>[t("div",Ce,[e[30]||(e[30]=t("div",{class:"info-label"},"Total Sessions (All Time)",-1)),t("div",xe,u(p.value.total_sessions),1)])]),_:1}),l(v,{cols:"12",md:"3"},{default:a(()=>[t("div",Pe,[e[31]||(e[31]=t("div",{class:"info-label"},"Total Logs Stored",-1)),t("div",Se,u(p.value.total_logs),1)])]),_:1}),l(v,{cols:"12",md:"3"},{default:a(()=>[t("div",Te,[e[32]||(e[32]=t("div",{class:"info-label"},"Database Size",-1)),t("div",Ie,u(p.value.database_size),1)])]),_:1}),l(v,{cols:"12",md:"3"},{default:a(()=>[t("div",Le,[e[33]||(e[33]=t("div",{class:"info-label"},"Last Cleanup",-1)),t("div",Ae,u(p.value.last_cleanup),1)])]),_:1})]),_:1}),l(w,{class:"my-4"}),e[34]||(e[34]=t("div",{class:"text-subtitle-2 mb-3"},"Scheduler Status",-1)),l(I,{color:p.value.scheduler_running?"success":"error","prepend-icon":p.value.scheduler_running?"mdi-check":"mdi-close"},{default:a(()=>[n(u(p.value.scheduler_running?"Running":"Offline"),1)]),_:1},8,["color","prepend-icon"]),l(I,{class:"ml-2",color:"info"},{default:a(()=>[n(" Cleanup Command: "+u(p.value.cleanup_last_run||"Never"),1)]),_:1}),l(I,{class:"ml-2",color:"info"},{default:a(()=>[n(" Pruning: "+u(p.value.pruning_last_run||"Never"),1)]),_:1})]),_:1})]),_:1})]),_:1}),l(v,{cols:"12"},{default:a(()=>[l(k,{class:"settings-card danger-zone",elevation:"2"},{default:a(()=>[l(_,{class:"card-header"},{default:a(()=>[l(T,{icon:"mdi-alert",class:"mr-2"}),e[35]||(e[35]=n(" Danger Zone ",-1))]),_:1}),l(w),l(V,{class:"pa-6"},{default:a(()=>[l(U,null,{default:a(()=>[l(v,{cols:"12",md:"4"},{default:a(()=>[l(g,{color:"warning",variant:"elevated","prepend-icon":"mdi-database-remove",onClick:Z,loading:r.value.cleanup,block:""},{default:a(()=>[...e[36]||(e[36]=[n(" Run Cleanup Now ",-1)])]),_:1},8,["loading"]),e[37]||(e[37]=t("div",{class:"text-caption mt-2 text-grey"}," Manually trigger zombie process cleanup ",-1))]),_:1}),l(v,{cols:"12",md:"4"},{default:a(()=>[l(g,{color:"warning",variant:"elevated","prepend-icon":"mdi-delete-sweep",onClick:J,loading:r.value.pruning,block:""},{default:a(()=>[...e[38]||(e[38]=[n(" Prune Old Logs ",-1)])]),_:1},8,["loading"]),e[39]||(e[39]=t("div",{class:"text-caption mt-2 text-grey"}," Delete logs older than retention period ",-1))]),_:1}),l(v,{cols:"12",md:"4"},{default:a(()=>[l(g,{color:"error",variant:"elevated","prepend-icon":"mdi-delete-forever",onClick:e[5]||(e[5]=o=>x.value=!0),block:""},{default:a(()=>[...e[40]||(e[40]=[n(" Clear All Logs ",-1)])]),_:1}),e[41]||(e[41]=t("div",{class:"text-caption mt-2 text-grey"}," ⚠️ Permanently delete all parsing logs ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(O,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=o=>C.value=o),"max-width":"500"},{default:a(()=>[l(k,null,{default:a(()=>[l(_,null,{default:a(()=>[...e[42]||(e[42]=[n("Regenerate Callback Token?",-1)])]),_:1}),l(V,null,{default:a(()=>[l($,{type:"warning",variant:"tonal",class:"mb-4"},{default:a(()=>[...e[43]||(e[43]=[n(" This will invalidate the current token. You must update the Python parser configuration with the new token, or callbacks will fail. ",-1)])]),_:1}),e[44]||(e[44]=t("p",null,"Are you sure you want to continue?",-1))]),_:1}),l(B,null,{default:a(()=>[l(M),l(g,{variant:"text",onClick:e[6]||(e[6]=o=>C.value=!1)},{default:a(()=>[...e[45]||(e[45]=[n("Cancel",-1)])]),_:1}),l(g,{color:"warning",variant:"elevated",onClick:K,loading:r.value.regenerateToken},{default:a(()=>[...e[46]||(e[46]=[n(" Regenerate ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(O,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=o=>x.value=o),"max-width":"500"},{default:a(()=>[l(k,null,{default:a(()=>[l(_,null,{default:a(()=>[...e[47]||(e[47]=[n("Clear All Logs?",-1)])]),_:1}),l(V,null,{default:a(()=>[l($,{type:"error",variant:"tonal",class:"mb-4"},{default:a(()=>[...e[48]||(e[48]=[n(" This action is IRREVERSIBLE. All parsing logs will be permanently deleted. ",-1)])]),_:1}),e[49]||(e[49]=t("p",null,[n("Type "),t("strong",null,"DELETE ALL LOGS"),n(" to confirm:")],-1)),l(E,{modelValue:L.value,"onUpdate:modelValue":e[8]||(e[8]=o=>L.value=o),placeholder:"DELETE ALL LOGS",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),l(B,null,{default:a(()=>[l(M),l(g,{variant:"text",onClick:e[9]||(e[9]=o=>x.value=!1)},{default:a(()=>[...e[50]||(e[50]=[n("Cancel",-1)])]),_:1}),l(g,{color:"error",variant:"elevated",disabled:L.value!=="DELETE ALL LOGS",onClick:Q},{default:a(()=>[...e[51]||(e[51]=[n(" Delete Forever ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(re,{modelValue:P.value.show,"onUpdate:modelValue":e[11]||(e[11]=o=>P.value.show=o),color:P.value.color},{default:a(()=>[n(u(P.value.message),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Fe=ue(De,[["__scopeId","data-v-a93f118f"]]);export{Fe as default};

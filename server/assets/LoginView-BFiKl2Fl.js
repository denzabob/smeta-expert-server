import{W as q,r as u,X as F,n as M,$ as B,C as w,a0 as R,G as o,D as r,aW as g,a2 as x,a1 as L,z as $,F as y,aX as j,d as N,w as U,a$ as S}from"./vendor-BQXrruHR.js";import{A as z}from"./AuthLogin-BhHkzooH.js";import{V as T,a as I,b as k,c as C,d as E,_,e as P,f as D,g as W,h as X,i as G,j as H,k as J}from"./index-B_oQPGco.js";const K={class:"d-flex justify-space-between align-center mt-2"},O="Если такой email существует, мы отправили на него инструкции по восстановлению пароля.",Q=q({__name:"AuthForgot",emits:["back"],setup(A,{emit:b}){const v=b,l=u({email:""}),p=u(),c=u(!1),V=u(),m=u(!1),a=u(""),t={required:i=>!!i&&i.trim()!==""||"Обязательное поле",email:i=>/.+@.+\..+/.test(i)||"Некорректный e-mail"};F(async()=>{await M(),V.value?.focus?.()});const f=async()=>{const{valid:i}=await p.value?.validate()??{valid:!1};if(i){m.value=!0,a.value="";try{await E.post("/api/forgot-password",{email:l.value.email})}catch(n){console.warn("Forgot-password request failed:",n)}finally{m.value=!1,a.value=O}}};return(i,n)=>(y(),B("div",null,[a.value?(y(),w(T,{key:0,type:"success",variant:"tonal",closable:"",class:"mb-4","onClick:close":n[0]||(n[0]=s=>a.value="")},{default:r(()=>[g(x(a.value),1)]),_:1})):R("",!0),o(I,{ref_key:"formRef",ref:p,modelValue:c.value,"onUpdate:modelValue":n[3]||(n[3]=s=>c.value=s),onSubmit:L(f,["prevent"])},{default:r(()=>[o(k,{ref_key:"emailRef",ref:V,modelValue:l.value.email,"onUpdate:modelValue":n[1]||(n[1]=s=>l.value.email=s),label:"E-mail",type:"email",autocomplete:"email",rules:[t.required,t.email]},null,8,["modelValue","rules"]),$("div",K,[o(C,{variant:"text",size:"small",class:"text-none px-0",onClick:n[2]||(n[2]=s=>v("back"))},{default:r(()=>[...n[4]||(n[4]=[g(" Назад ко входу ",-1)])]),_:1}),o(C,{color:"primary",class:"text-none",loading:m.value,disabled:!c.value,type:"submit"},{default:r(()=>[...n[5]||(n[5]=[g(" Отправить ссылку ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["modelValue"])]))}}),Y=_(Q,[["__scopeId","data-v-d0c4639a"]]),Z={class:"d-flex justify-space-between align-center mt-2"},h=q({__name:"AuthRegister",emits:["login"],setup(A,{emit:b}){const v=b,l=u({name:"",email:"",password:"",passwordConfirm:"",acceptTerms:!1}),p=u(),c=u(!1),V=u(),m=u(!1),a=u(""),t=u(!1),f=u(!1),i={required:s=>!!s&&s.trim()!==""||"Обязательное поле",email:s=>/.+@.+\..+/.test(s)||"Некорректный e-mail",minLength:s=>e=>e&&e.length>=s||`Минимум ${s} символов`,passwordMatch:s=>s===l.value.password||"Пароли не совпадают",mustAccept:s=>s===!0||"Необходимо принять условия"};F(async()=>{await M(),V.value?.focus?.()});const n=async()=>{const{valid:s}=await p.value?.validate()??{valid:!1};s&&(m.value=!0,a.value="",await new Promise(e=>setTimeout(e,400)),m.value=!1,a.value="Регистрация будет доступна позже. Функция находится в разработке.")};return(s,e)=>(y(),B("div",null,[a.value?(y(),w(T,{key:0,type:"info",variant:"tonal",closable:"",class:"mb-4","onClick:close":e[0]||(e[0]=d=>a.value="")},{default:r(()=>[g(x(a.value),1)]),_:1})):R("",!0),o(I,{ref_key:"formRef",ref:p,modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=d=>c.value=d),onSubmit:L(n,["prevent"])},{default:r(()=>[o(k,{ref_key:"nameRef",ref:V,modelValue:l.value.name,"onUpdate:modelValue":e[1]||(e[1]=d=>l.value.name=d),label:"Имя",autocomplete:"name"},null,8,["modelValue"]),o(k,{modelValue:l.value.email,"onUpdate:modelValue":e[2]||(e[2]=d=>l.value.email=d),label:"E-mail",type:"email",autocomplete:"email",rules:[i.required,i.email]},null,8,["modelValue","rules"]),o(k,{modelValue:l.value.password,"onUpdate:modelValue":e[3]||(e[3]=d=>l.value.password=d),label:"Пароль",type:t.value?"text":"password",autocomplete:"new-password",rules:[i.required,i.minLength(8)],"append-inner-icon":t.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[4]||(e[4]=d=>t.value=!t.value)},null,8,["modelValue","type","rules","append-inner-icon"]),o(k,{modelValue:l.value.passwordConfirm,"onUpdate:modelValue":e[5]||(e[5]=d=>l.value.passwordConfirm=d),label:"Подтвердите пароль",type:f.value?"text":"password",autocomplete:"new-password",rules:[i.required,i.passwordMatch],"append-inner-icon":f.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[6]||(e[6]=d=>f.value=!f.value)},null,8,["modelValue","type","rules","append-inner-icon"]),o(P,{modelValue:l.value.acceptTerms,"onUpdate:modelValue":e[7]||(e[7]=d=>l.value.acceptTerms=d),rules:[i.mustAccept],density:"compact"},{label:r(()=>[...e[10]||(e[10]=[$("span",{class:"text-body-2"},"Согласен с условиями использования",-1)])]),_:1},8,["modelValue","rules"]),$("div",Z,[o(C,{variant:"text",size:"small",class:"text-none px-0",onClick:e[8]||(e[8]=d=>v("login"))},{default:r(()=>[...e[11]||(e[11]=[g(" Уже есть аккаунт? Войти ",-1)])]),_:1}),o(C,{color:"primary",class:"text-none",loading:m.value,disabled:!c.value,type:"submit"},{default:r(()=>[...e[12]||(e[12]=[g(" Создать аккаунт ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["modelValue"])]))}}),ee=_(h,[["__scopeId","data-v-a6a7e42c"]]),ae=q({__name:"LoginView",setup(A){const b=S(),v=j(),l=u(v.query.mode||"login"),p=u(""),c=N(()=>l.value==="forgot"?"Восстановление пароля":"Вход в систему");U(()=>v.query.mode,a=>{const t=typeof a=="string"?a:"";(t==="forgot"||t==="login"||t==="register")&&(l.value=t)},{immediate:!0}),U(()=>v.query.message,a=>{a==="password-reset"&&(p.value="Пароль изменён")},{immediate:!0});const V=async()=>{p.value="";const a={...v.query};delete a.message,await b.replace({query:a})},m=async a=>{l.value=a,await b.replace({query:{...v.query,mode:a}})};return(a,t)=>(y(),w(D,{class:"fill-height",fluid:""},{default:r(()=>[o(J,{align:"center",justify:"center"},{default:r(()=>[o(W,{cols:"12",sm:"8",md:"5",lg:"4"},{default:r(()=>[o(X,null,{default:r(()=>[o(G,{class:"text-h6"},{default:r(()=>[g(x(c.value),1)]),_:1}),o(H,null,{default:r(()=>[p.value?(y(),w(T,{key:0,type:"success",variant:"tonal",closable:"",class:"mb-4","onClick:close":V},{default:r(()=>[g(x(p.value),1)]),_:1})):R("",!0),l.value==="login"?(y(),w(z,{key:1,onForgot:t[0]||(t[0]=f=>m("forgot")),onRegister:t[1]||(t[1]=f=>m("register"))})):l.value==="forgot"?(y(),w(Y,{key:2,onBack:t[2]||(t[2]=f=>m("login"))})):(y(),w(ee,{key:3,onLogin:t[3]||(t[3]=f=>m("login"))}))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),oe=_(ae,[["__scopeId","data-v-51589a42"]]);export{oe as default};

import{be as D,r as u,C as q,D as t,G as l,bi as n,bD as b,bk as B,F}from"./vendor-CKnqOB-T.js";import{V as M,k as f,c as C,g as k,i as d,n as I,o as y,b as w,d as N,e as A,f as i,h as E,t as G}from"./index-B66HMlcK.js";const H=D({__name:"ProjectsView",setup(R){const p=B(),V=u([]),m=u(!1),s=u(!1),c=u(!1),r=u({number:"",expert_name:"",address:"",waste_coefficient:1.2,repair_coefficient:1}),j=[{title:"№ дела",key:"number"},{title:"Эксперт",key:"expert_name"},{title:"Адрес",key:"address"},{title:"Действия",key:"actions",sortable:!1}],x=({item:o})=>({onClick:()=>$(o),style:{cursor:"pointer"}}),v=async()=>{m.value=!0;try{V.value=(await f.get("/api/projects")).data}catch(o){console.error("Ошибка загрузки проектов:",o)}finally{m.value=!1}},g=async()=>{try{const e=(await f.post("/api/projects",r.value)).data.id;s.value=!1,p.push(`/projects/${e}/edit`)}catch(o){console.error("Ошибка создания проекта:",o),alert("Не удалось создать проект")}},_=()=>{s.value=!0,r.value={number:"",expert_name:"",address:"",waste_coefficient:1.2,repair_coefficient:1}},$=o=>{p.push(`/projects/${o.id}/edit`)},P=o=>{p.push(`/projects/${o.id}/edit`)},U=async o=>{if(confirm(`Удалить проект "${o.number}"?`))try{await f.delete(`/api/projects/${o.id}`),v()}catch(e){console.error("Ошибка удаления:",e),alert("Не удалось удалить проект")}};return v(),(o,e)=>(F(),q(M,null,{default:t(()=>[l(w,null,{default:t(()=>[l(C,null,{default:t(()=>[...e[8]||(e[8]=[n("Проекты",-1)])]),_:1}),l(k,null,{default:t(()=>[l(d,{"prepend-icon":"mdi-plus",onClick:_},{default:t(()=>[...e[9]||(e[9]=[n("Новый проект",-1)])]),_:1})]),_:1}),l(I,{headers:j,items:V.value,loading:m.value,"row-props":x,"item-value":"id"},{"item.actions":t(({item:a})=>[l(d,{icon:"",onClick:b(T=>P(a),["stop"])},{default:t(()=>[l(y,null,{default:t(()=>[...e[10]||(e[10]=[n("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"]),l(d,{icon:"",onClick:b(T=>U(a),["stop"])},{default:t(()=>[l(y,null,{default:t(()=>[...e[11]||(e[11]=[n("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1},8,["items","loading"])]),_:1}),l(G,{modelValue:s.value,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value=a),"max-width":"600"},{default:t(()=>[l(w,null,{default:t(()=>[l(C,null,{default:t(()=>[...e[12]||(e[12]=[n("Новый проект",-1)])]),_:1}),l(N,null,{default:t(()=>[l(A,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=a=>c.value=a)},{default:t(()=>[l(i,{modelValue:r.value.number,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.number=a),label:"№ дела",required:""},null,8,["modelValue"]),l(i,{modelValue:r.value.expert_name,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.expert_name=a),label:"ФИО эксперта",required:""},null,8,["modelValue"]),l(i,{modelValue:r.value.address,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.address=a),label:"Адрес объекта",required:""},null,8,["modelValue"]),l(i,{modelValue:r.value.waste_coefficient,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.waste_coefficient=a),modelModifiers:{number:!0},label:"Коэффициент обрезков",type:"number",step:"0.01",min:"1"},null,8,["modelValue"]),l(i,{modelValue:r.value.repair_coefficient,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.repair_coefficient=a),modelModifiers:{number:!0},label:"Ремонтный коэффициент",type:"number",step:"0.01",min:"1"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(k,null,{default:t(()=>[l(E),l(d,{onClick:e[6]||(e[6]=a=>s.value=!1)},{default:t(()=>[...e[13]||(e[13]=[n("Отмена",-1)])]),_:1}),l(d,{color:"primary",onClick:g},{default:t(()=>[...e[14]||(e[14]=[n("Создать",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{H as default};

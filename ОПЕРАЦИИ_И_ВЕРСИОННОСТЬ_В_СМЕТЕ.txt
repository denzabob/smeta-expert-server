# –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ —Å–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö](#–º–æ–¥–µ–ª–∏-–¥–∞–Ω–Ω—ã—Ö)
3. [–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–ø–µ—Ä–∞—Ü–∏–π](#–∂–∏–∑–Ω–µ–Ω–Ω—ã–π-—Ü–∏–∫–ª-–æ–ø–µ—Ä–∞—Ü–∏–π)
4. [–í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å –≤ —Å–º–µ—Ç–µ](#–≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å-–≤-—Å–º–µ—Ç–µ)
5. [–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π](#–∏—Å—Ç–æ—á–Ω–∏–∫–∏-–æ–ø–µ—Ä–∞—Ü–∏–π)
6. [–†–∞—Å—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π](#—Ä–∞—Å—á–µ—Ç-–æ–ø–µ—Ä–∞—Ü–∏–π)
7. [API –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ](#api-–∏-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)
8. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–º–µ—Ç–æ–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ **—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** ‚Äì –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (—Ä–µ–∑–∫–∞, —Å–≤–µ—Ä–ª–µ–Ω–∏–µ, –∫—Ä–æ–º–∫–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ—á–∏–µ –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã), –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–º–µ—Ç—É –ø—Ä–æ–µ–∫—Ç–∞.

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è

- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (Operation)** ‚Äì —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å —Ü–µ–Ω–æ–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- **–û–ø–µ—Ä–∞—Ü–∏—è –≤ —Å–º–µ—Ç–µ (ProjectManualOperation)** ‚Äì –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –ø—Ä–æ–µ–∫—Ç
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** ‚Äì —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–æ–≤ –¥–µ—Ç–∞–ª–µ–π –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- **–í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å** ‚Äì —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω

---

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. Operation (–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)

**–¢–∞–±–ª–∏—Ü–∞:** `operations`

```php
class Operation {
    - id: integer
    - name: string                          // "–†–µ–∑–∫–∞ –¥–æ—Å–∫–∏", "–°–≤–µ—Ä–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏—è"
    - search_name: string                   // –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è –¥–ª—è –ø–æ–∏—Å–∫–∞
    - category: string                      // "–†–∞—Å–ø–∏–ª–æ–≤–∫–∞", "–°–≤–µ—Ä–ª–µ–Ω–∏–µ", "–ö—Ä–æ–º–∫–∏—Ä–æ–≤–∞–Ω–∏–µ"
    - exclusion_group: string               // "cutting", "edging", "drilling" (–¥–ª—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
    - min_thickness: decimal                // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–æ–ª—â–∏–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
    - max_thickness: decimal                // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ–ª—â–∏–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
    - cost_per_unit: decimal:2              // –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É (—Ä—É–±. –∑–∞ –º¬≤, —à—Ç –∏ —Ç.–¥.)
    - unit: string                          // "–º¬≤", "—à—Ç", "–º.–ø." –∏ —Ç.–¥.
    - description: string                   // –û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
    - user_id: integer                      // –ê–≤—Ç–æ—Ä (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
    - origin: string                        // "system", "parser", "user"
    - created_at, updated_at
}
```

**–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ (origin):**
- `system` ‚Äì –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º—É –æ–ø–µ—Ä–∞—Ü–∏–∏
- `parser` ‚Äì –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–∞–π—Å–æ–≤ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
- `user` ‚Äì —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

### 2. ProjectManualOperation (–û–ø–µ—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ)

**–¢–∞–±–ª–∏—Ü–∞:** `project_manual_operations`

```php
class ProjectManualOperation {
    - id: integer
    - project_id: integer
    - operation_id: integer                 // FK -> operations
    - quantity: decimal                     // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π
    - note: string                          // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    - created_at, updated_at
    
    // –°–≤—è–∑–∏
    -> project (Project)
    -> operation (Operation)
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–∏–≤—è–∑–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞.

### 3. DetailTypeOperation (–û–ø–µ—Ä–∞—Ü–∏—è —Ç–∏–ø–∞ –¥–µ—Ç–∞–ª–∏)

**–¢–∞–±–ª–∏—Ü–∞:** `detail_type_operations`

```php
class DetailTypeOperation {
    - id: integer
    - detail_type_id: integer               // FK -> detail_types
    - operation_id: integer                 // FK -> operations
    - quantity_formula: string              // –§–æ—Ä–º—É–ª–∞: "width * length / 1000" –∏ —Ç.–¥.
    - created_at, updated_at
    
    // –°–≤—è–∑–∏
    -> detailType (DetailType)
    -> operation (Operation)
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –∫–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ —Ç–∏–ø—É –¥–µ—Ç–∞–ª–∏ –∏ –ø–æ –∫–∞–∫–æ–π —Ñ–æ—Ä–º—É–ª–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.

### 4. PriceList (–ü—Ä–∞–π—Å-–ª–∏—Å—Ç)

**–¢–∞–±–ª–∏—Ü–∞:** `price_lists`

```php
class PriceList {
    - id: integer
    - supplier_id: integer
    - name: string                          // "–°–º–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –ú–∞–π 2025"
    - type: enum('operations', 'materials') // –¢–∏–ø –ø—Ä–∞–π—Å–∞
    - description: string
    - default_currency: string              // "RUB"
    - metadata: json
    - is_active: boolean
    - created_at, updated_at
    
    // –°–≤—è–∑–∏
    -> supplier (Supplier)
    -> versions (HasMany -> PriceListVersion)
    -> activeVersion (HasOne -> PriceListVersion) // –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è
    -> latestVersion (HasOne -> PriceListVersion) // –°–∞–º–∞—è –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤–µ—Ä—Å–∏–π –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞.

### 5. PriceListVersion (–í–µ—Ä—Å–∏—è –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞)

**–¢–∞–±–ª–∏—Ü–∞:** `price_list_versions`

```php
class PriceListVersion {
    - id: integer
    - price_list_id: integer
    - version_number: integer               // 1, 2, 3... (–ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä)
    - sha256: string                        // –•–µ—à —Ñ–∞–π–ª–∞ –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
    - size_bytes: integer
    - currency: string                      // "RUB"
    - effective_date: date                  // –î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É
    - captured_at: datetime                 // –ö–æ–≥–¥–∞ –±—ã–ª –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
    - file_path: string                     // –ü—É—Ç—å –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    - storage_disk: string                  // "local", "s3"
    - original_filename: string             // –ò–º—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    - source_type: enum('file', 'manual', 'url')
    - source_url: string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    - manual_label: string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)    // –ï—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–∞ –≤—Ä—É—á–Ω—É—é
    - status: enum('inactive', 'active', 'archived')
    - metadata: json
    - notes: string
    - created_at, updated_at
    
    // –°–≤—è–∑–∏
    -> priceList (PriceList)
    -> operationPrices (HasMany -> OperationPrice)
    -> materialPrices (HasMany -> MaterialPrice)
    -> importSessions (HasMany -> PriceImportSession)
}
```

**–°—Ç–∞—Ç—É—Å—ã –≤–µ—Ä—Å–∏–∏:**
- `inactive` ‚Äì –≤–µ—Ä—Å–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `active` ‚Äì —Ç–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–º–µ—Ç–µ
- `archived` ‚Äì —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è, –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–æ–≤–æ–π

### 6. OperationPrice (–¶–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –≤–µ—Ä—Å–∏–∏)

**–¢–∞–±–ª–∏—Ü–∞:** `operation_prices`

```php
class OperationPrice {
    - id: integer
    - price_list_version_id: integer        // FK -> price_list_versions
    - operation_id: integer                 // FK -> operations
    - source_price: decimal:4                // –ò—Å—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ –∏–∑ –ø—Ä–∞–π—Å–∞
    - source_unit: string                   // –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑ –ø—Ä–∞–π—Å–∞
    - conversion_factor: decimal:6          // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–µ—Ä–µ—Å—á–µ—Ç–∞
    - price_per_internal_unit: decimal:4    // –†–∞—Å—á–µ—Ç–Ω–∞—è —Ü–µ–Ω–∞ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É
    - currency: string
    - source_row_index: integer             // –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
    - category: string                      // –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
    - description: string
    - min_thickness: decimal:2
    - max_thickness: decimal:2
    - exclusion_group: string
    - created_at, updated_at
    
    // –°–≤—è–∑–∏
    -> priceListVersion (PriceListVersion)
    -> operation (Operation)
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–∏–≤—è–∑–∫–∞ —Ü–µ–Ω—ã –∏–∑ –ø—Ä–∞–π—Å–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∫ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–µ—Ä–µ—Ä–∞—Å—á–µ—Ç–æ–º –µ–¥–∏–Ω–∏—Ü.

### 7. SupplierOperationPrice (–¶–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)

**–¢–∞–±–ª–∏—Ü–∞:** `supplier_operation_prices`

```php
class SupplierOperationPrice {
    - id: integer
    - supplier_operation_id: integer
    - price_list_version_id: integer        // FK -> price_list_versions
    - price_value: decimal:2                // –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
    - unit: string                          // "–º¬≤", "—à—Ç"
    - price_type: enum('retail', 'wholesale')
    - currency: string
    - source_row_index: integer
    - created_at, updated_at
    
    // –°–≤—è–∑–∏
    -> supplierOperation (SupplierOperation)
    -> priceListVersion (PriceListVersion)
}
```

### 8. PriceImportSession (–°–µ—Å—Å–∏—è –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–∞–π—Å–∞)

**–¢–∞–±–ª–∏—Ü–∞:** `price_import_sessions`

```php
class PriceImportSession {
    - id: uuid
    - user_id: integer
    - price_list_version_id: integer (opional)
    - supplier_id: integer
    - target_type: enum('operations', 'materials')
    - file_path: string
    - storage_disk: string
    - original_filename: string
    - file_type: enum('xlsx', 'xls', 'csv', 'html', 'paste')
    - status: enum (—Å–º. –Ω–∏–∂–µ)
    - header_row_index: integer
    - sheet_index: integer
    - column_mapping: json                  // { "A": "name", "B": "price", ... }
    - options: json                         // –û–ø—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    - raw_rows: json                        // –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
    - resolution_queue: json                // –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
    - stats: json                           // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    - result: json                          // –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    - error_message: string
    - error_details: json
    - created_at, updated_at
    
    // –°–≤—è–∑–∏
    -> user (User)
    -> priceListVersion (PriceListVersion)
}
```

**–°—Ç–∞—Ç—É—Å—ã –∏–º–ø–æ—Ä—Ç–∞:**
- `created` ‚Äì —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞, —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω
- `parsing_failed` ‚Äì –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Ñ–∞–π–ª–∞
- `mapping_required` ‚Äì —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫
- `resolution_required` ‚Äì —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- `execution_running` ‚Äì –∏–º–ø–æ—Ä—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- `completed` ‚Äì –∏–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ
- `execution_failed` ‚Äì –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏–º–ø–æ—Ä—Ç–∞

---

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–ø–µ—Ä–∞—Ü–∏–π

### –≠—Ç–∞–ø 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

#### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ:

1. **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (origin = 'system')
   - –°–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã
   - –°–æ–¥–µ—Ä–∂–∞—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –º–µ–±–µ–ª–∏
   - –ù–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

2. **–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–∞–π—Å–æ–≤** (origin = 'parser')
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
   - –•—Ä–∞–Ω—è—Ç –¥–∞–Ω–Ω—ã–µ –æ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫
   - –°–≤—è–∑–∞–Ω—ã —Å –≤–µ—Ä—Å–∏–µ–π –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞ —á–µ—Ä–µ–∑ OperationPrice

3. **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º** (origin = 'user')
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
   - –£–Ω–∏–∫–∞–ª—å–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (user_id –∑–∞–ø–æ–ª–Ω–µ–Ω)
   - –ú–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —É–¥–∞–ª–µ–Ω—ã

### –≠—Ç–∞–ø 2: –°–≤—è–∑—å –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ç–∏–ø–æ–º –¥–µ—Ç–∞–ª–∏

–í —Å–∏—Å—Ç–µ–º–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã **—Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π**, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–º–µ—Ç—É:

#### A. –û–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ –¥–µ—Ç–∞–ª–∏ (source = 'detail_type')

```php
// DetailType —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ detail_type_operations
DetailType -> hasMany(DetailTypeOperation) -> belongsTo(Operation)

// –ü—Ä–∏–º–µ—Ä
DetailType "–ü–æ–ª–∫–∞" –∏–º–µ–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏:
- –†–µ–∑–∫–∞ –∫—Ä–æ–º–∫–∏ (quantity_formula: "perimeter / 1000")
- –°–≤–µ—Ä–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏–π (quantity_formula: "drilling_holes_count()")
```

**–§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞:**
- –ü—Ä–æ—Å—Ç—ã–µ: `"10"` (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞)
- –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–∑–∏—Ü–∏–∏: `"width * length / 1000"`
- –° —Ñ—É–Ω–∫—Ü–∏—è–º–∏: `"drilling_holes_count()"` (–≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ edge_scheme –∏ —Ä–∞–∑–º–µ—Ä–æ–≤)

#### B. –û–ø–µ—Ä–∞—Ü–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ (source = 'material')

```php
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –≤ –ø–æ–∑–∏—Ü–∏–∏
Material -> –∏–º–µ–µ—Ç waste_factor –∏ thickness
Operation -> –∏–º–µ–µ—Ç exclusion_group = 'cutting' –∏ min_thickness/max_thickness

// –õ–æ–≥–∏–∫–∞ –ø–æ–¥–±–æ—Ä–∞:
- –ò—â–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å exclusion_group = 'cutting'
- –§–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –ø–æ —Ç–æ–ª—â–∏–Ω–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
- –í—ã–±–∏—Ä–∞–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º —Ç–æ–ª—â–∏–Ω
```

**–†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:**
```
material_qty = area_m2 √ó waste_factor √ó position_quantity
–≥–¥–µ area_m2 = (width √ó length) / 1_000_000
```

#### C. –û–ø–µ—Ä–∞—Ü–∏–∏ –∫—Ä–æ–º–∫–∏—Ä–æ–≤–∞–Ω–∏—è (source = 'edge_processing')

```php
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫—Ä–æ–º–∫–∏ –≤ –ø–æ–∑–∏—Ü–∏–∏
edge_qty = edge_length_m √ó waste_factor √ó position_quantity

// edge_length_m –∑–∞–≤–∏—Å–∏—Ç –æ—Ç edge_scheme:
- 'O' (–≤–∫—Ä—É–≥): (W + L) √ó 2
- '=' (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å): L √ó 2
- '||' (–≤–µ—Ä—Ç–∏–∫–∞–ª—å): W √ó 2
- 'L' (—É–≥–æ–ª): W + L
- '–ü' (—Ç—Ä–∏ —Å—Ç–æ—Ä–æ–Ω—ã): L √ó 2 + W
```

### –≠—Ç–∞–ø 3: –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –≤ —Å–º–µ—Ç—É –ø—Ä–æ–µ–∫—Ç–∞:

```php
// ProjectManualOperation —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ API
POST /api/projects/{project}/operations
{
    "operation_id": 123,
    "quantity": 2.5,
    "note": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —à–ª–∏—Ñ–æ–≤–∫–∞"
}
```

### –≠—Ç–∞–ø 4: –†–∞—Å—á–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–º–µ—Ç–µ

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–∏—Å—Ç–µ–º–∞:
1. –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (3 –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
2. –î–æ–±–∞–≤–ª—è–µ—Ç —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑ ProjectManualOperation
3. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ ID (–∞–≥—Ä–µ–≥–∞—Ü–∏—è)
4. –°—É–º–º–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ —Ç–∏–ø–∞–º –æ–ø–µ—Ä–∞—Ü–∏–π
5. –í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ —Ü–µ–Ω–µ –∏–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∞–π—Å–∞

```php
// API endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
GET /api/projects/{project}/operations

–û—Ç–≤–µ—Ç:
[
    {
        "operation_id": 5,
        "name": "–†–µ–∑–∫–∞ –õ–î–°–ü",
        "category": "–†–∞—Å–ø–∏–ª–æ–≤–∫–∞",
        "unit": "–º¬≤",
        "cost_per_unit": 150.00,
        "quantity": 12.5,
        "source": "material",  // –∏–ª–∏ "detail_type", "manual"
        "total_cost": 1875.00
    },
    ...
]
```

---

## –í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å –≤ —Å–º–µ—Ç–µ

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–Ω–æ–≥–æ–≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∞–π—Å–æ–≤** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏:

```
PriceList (–≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –≤—Å–µ –≤–µ—Ä—Å–∏–∏)
‚îú‚îÄ‚îÄ PriceListVersion v1 (status: inactive)    –ú–∞–π 2025, —Ü–µ–Ω–∞ —Ä–µ–∑–∫–∏ 100 —Ä—É–±/–º¬≤
‚îú‚îÄ‚îÄ PriceListVersion v2 (status: inactive)    –ò—é–Ω—å 2025, —Ü–µ–Ω–∞ —Ä–µ–∑–∫–∏ 110 —Ä—É–±/–º¬≤
‚îú‚îÄ‚îÄ PriceListVersion v3 (status: active)      –ò—é–ª—å 2025, —Ü–µ–Ω–∞ —Ä–µ–∑–∫–∏ 120 —Ä—É–±/–º¬≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îî‚îÄ‚îÄ PriceListVersion v4 (status: archived)    (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```

### –°—Ç–∞—Ç—É—Å—ã –≤–µ—Ä—Å–∏–∏

| –°—Ç–∞—Ç—É—Å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------------|---------|
| `inactive` | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ù–æ–≤–∞—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è, –Ω–µ –æ–¥–æ–±—Ä–µ–Ω–∞ |
| `active` | **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** | –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è, –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–∞—Ö —Å–º–µ—Ç—ã |
| `archived` | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ó–∞–º–µ–Ω–µ–Ω–∞ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π, —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ |

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—ã–±–æ—Ä —Ü–µ–Ω—ã

–ü—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Å–º–µ—Ç–µ:

```php
// 1. –ò—â–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∞–π—Å–∞
$activeVersion = $priceList->activeVersion();

// 2. –ò–∑ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏ –±–µ—Ä–µ—Ç—Å—è —Ü–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
$operationPrice = OperationPrice::where([
    'price_list_version_id' => $activeVersion->id,
    'operation_id' => $operationId
])->first();

$pricePerUnit = $operationPrice->price_per_internal_unit ?? 
                $operation->cost_per_unit;  // Fallback –Ω–∞ –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É

// 3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
$totalCost = $quantity * $pricePerUnit;
```

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

–ö–∞–∂–¥–∞—è –≤–µ—Ä—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç:
- **effective_date** ‚Äì –∫–æ–≥–¥–∞ –≤—Å—Ç—É–ø–∏–ª–∞ –≤ —Å–∏–ª—É
- **captured_at** ‚Äì –∫–æ–≥–¥–∞ –±—ã–ª–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º—É
- **file_path** ‚Äì –ø—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É
- **sha256** ‚Äì —Ö–µ—à –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- **stats** ‚Äì –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π/–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –û—Ç—Å–ª–µ–¥–∏—Ç—å, –∫–∞–∫–∞—è —Ü–µ–Ω–∞ –±—ã–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Å–º–µ—Ç—ã
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω
- –ò–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö –ø—Ä–∞–π—Å–æ–≤ (–ø–æ —Ö–µ—à—É)

---

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π

### –ò–µ—Ä–∞—Ä—Ö–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–º–µ—Ç–µ

```
–°–º–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∏–∑ —Ç–∏–ø–æ–≤ –¥–µ—Ç–∞–ª–µ–π)
‚îÇ   ‚îú‚îÄ‚îÄ –û–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ –¥–µ—Ç–∞–ª–∏ (DetailTypeOperation)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ –ü–æ —Ñ–æ—Ä–º—É–ª–∞–º quantity_formula
‚îÇ   ‚îú‚îÄ‚îÄ –û–ø–µ—Ä–∞—Ü–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ (cutting)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ –ü–æ–¥–±–∏—Ä–∞—é—Ç—Å—è –ø–æ —Ç–æ–ª—â–∏–Ω–µ –∏ waste_factor
‚îÇ   ‚îî‚îÄ‚îÄ –û–ø–µ—Ä–∞—Ü–∏–∏ –∫—Ä–æ–º–∫–∏—Ä–æ–≤–∞–Ω–∏—è (edging)
‚îÇ       ‚îî‚îÄ‚îÄ –ü–æ –¥–ª–∏–Ω–µ –∫—Ä–æ–º–∫–∏ –∏ edge_scheme
‚îÇ
‚îú‚îÄ‚îÄ –†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (ProjectManualOperation)
‚îÇ   ‚îî‚îÄ‚îÄ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —è–≤–Ω–æ
‚îÇ
‚îî‚îÄ‚îÄ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
    ‚îú‚îÄ‚îÄ –ú–æ–Ω—Ç–∞–∂–Ω–æ-—Å–±–æ—Ä–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã (–Ω–æ—Ä–º–æ-—á–∞—Å)
    ‚îî‚îÄ‚îÄ –ü—Ä–æ—á–∏–µ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ì—Ä—É–ø–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏—è (exclusion_group):**

–û–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è **–Ω–µ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è**, –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞:

```php
Operation::where('exclusion_group', 'cutting')
  ->orderBy('min_thickness')
  ->first();

// –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∞—Å–ø–∏–ª–æ–≤–∫–∏, —Å–∏—Å—Ç–µ–º–∞ –≤—ã–±–∏—Ä–∞–µ—Ç
// —Å–∞–º—É—é –ø–æ–¥—Ö–æ–¥—è—â—É—é –ø–æ —Ç–æ–ª—â–∏–Ω–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
```

**–¢–∏–ø–∏—á–Ω—ã–µ –≥—Ä—É–ø–ø—ã:**
- `cutting` ‚Äì —Ä–∞—Å–ø–∏–ª–æ–≤–∫–∞ (—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª)
- `edging` ‚Äì –∫—Ä–æ–º–∫–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –Ω–∞ –∫—Ä–∞–π)
- `drilling` ‚Äì —Å–≤–µ—Ä–ª–µ–Ω–∏–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)

---

## –†–∞—Å—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π

### AutoOperationCalculator

**–ö–ª–∞—Å—Å:** `App\Services\AutoOperationCalculator`

```php
public function calculate(Project $project): array
{
    // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
    // —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
    
    $detailOps = [];    // –û–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑ DetailType
    $materialOps = [];  // –û–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞—Å–ø–∏–ª–æ–≤–∫–∏/—Ä–µ–∑–∫–∏
    $edgeOps = [];      // –û–ø–µ—Ä–∞—Ü–∏–∏ –∫—Ä–æ–º–∫–∏—Ä–æ–≤–∞–Ω–∏—è
    
    // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
    [
        'operation_id' => 5,
        'name' => '–†–µ–∑–∫–∞ –õ–î–°–ü',
        'category' => '–†–∞—Å–ø–∏–ª–æ–≤–∫–∞',
        'unit' => 'm¬≤',
        'cost_per_unit' => 150.00,
        'quantity' => 12.5,
        'source' => 'material',
        'exclusion_group' => 'cutting'
    ]
}
```

### –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–æ–≤

#### –ü—Ä–∏–º–µ—Ä 1: –û–ø–µ—Ä–∞—Ü–∏—è —Ç–∏–ø–∞ –¥–µ—Ç–∞–ª–∏

```
DetailType "–ü–æ–ª–∫–∞":
‚îú‚îÄ‚îÄ –†–µ–∑–∫–∞ –∫—Ä–æ–º–∫–∏ (formula: "perimeter / 1000")
‚îî‚îÄ‚îÄ –°–≤–µ—Ä–ª–µ–Ω–∏–µ (formula: "drilling_count")

–ü–æ–∑–∏—Ü–∏—è:
‚îú‚îÄ‚îÄ quantity: 2
‚îú‚îÄ‚îÄ width: 800mm, length: 400mm
‚îî‚îÄ‚îÄ edge_scheme: 'O'

–†–∞—Å—á–µ—Ç:
- –ü–µ—Ä–∏–º–µ—Ç—Ä = (800 + 400) √ó 2 = 2400mm = 2.4m
- –†–µ–∑–∫–∞ –∫—Ä–æ–º–∫–∏: 2.4m √ó 2 –ø–æ–∑–∏—Ü–∏–∏ = 4.8m
- –°–≤–µ—Ä–ª–µ–Ω–∏—è: drilling_count √ó 2 –ø–æ–∑–∏—Ü–∏–∏ = N —à—Ç
```

#### –ü—Ä–∏–º–µ—Ä 2: –û–ø–µ—Ä–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞

```
–ü–æ–∑–∏—Ü–∏—è:
‚îú‚îÄ‚îÄ material_id: –õ–î–°–ü 18mm
‚îú‚îÄ‚îÄ width: 800mm, length: 400mm
‚îú‚îÄ‚îÄ quantity: 3

Material –õ–î–°–ü:
‚îú‚îÄ‚îÄ thickness: 18mm
‚îú‚îÄ‚îÄ waste_factor: 1.1

–†–∞—Å—á–µ—Ç:
- area_m2 = (800 √ó 400) / 1_000_000 = 0.32 –º¬≤
- qty = 0.32 √ó 1.1 √ó 3 = 1.056 –º¬≤
- –ò—â–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å exclusion_group='cutting' –∏ 18mm —Ç–æ–ª—â–∏–Ω–∞
- –°—Ç–æ–∏–º–æ—Å—Ç—å = 1.056 –º¬≤ √ó 120 —Ä—É–±/–º¬≤ = 126.72 —Ä—É–±
```

#### –ü—Ä–∏–º–µ—Ä 3: –û–ø–µ—Ä–∞—Ü–∏—è –∫—Ä–æ–º–∫–∏—Ä–æ–≤–∞–Ω–∏—è

```
–ü–æ–∑–∏—Ü–∏—è:
‚îú‚îÄ‚îÄ edge_material_id: –∫—Ä–æ–º–∫–∞ –ü–í–•
‚îú‚îÄ‚îÄ edge_scheme: 'O' (–≤–∫—Ä—É–≥)
‚îú‚îÄ‚îÄ width: 800mm, length: 400mm
‚îú‚îÄ‚îÄ quantity: 3

Edge Material:
‚îú‚îÄ‚îÄ thickness: 2mm
‚îú‚îÄ‚îÄ waste_factor: 1.15

–†–∞—Å—á–µ—Ç:
- length_mm = (800 + 400) √ó 2 = 2400mm
- length_m = 2400 / 1000 = 2.4m
- qty = 2.4 √ó 1.15 √ó 3 = 8.28m
- –ò—â–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å exclusion_group='edging' –∏ 2mm —Ç–æ–ª—â–∏–Ω–∞
- –°—Ç–æ–∏–º–æ—Å—Ç—å = 8.28m √ó 50 —Ä—É–±/m = 414 —Ä—É–±
```

---

## API –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints

#### 1. –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –æ–ø–µ—Ä–∞—Ü–∏–π

```
GET /api/operations
- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ user_id –∏–ª–∏ origin)

GET /api/operations/:id
- –ü–æ–ª—É—á–∏—Ç—å –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é

POST /api/operations
- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –æ–ø–µ—Ä–∞—Ü–∏—é (origin='user')

PUT /api/operations/:id
- –û–±–Ω–æ–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ origin='user')

DELETE /api/operations/:id
- –£–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ origin='user')
```

#### 2. –û–ø–µ—Ä–∞—Ü–∏–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ

```
GET /api/projects/:project/operations
- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: [
    {operation_id, name, category, unit, cost_per_unit, quantity, source, total_cost}
  ]

POST /api/projects/:project/operations
- –î–æ–±–∞–≤–∏—Ç—å —Ä—É—á–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
- Body: {operation_id, quantity, note}

PUT /api/project-operations/:id
- –û–±–Ω–æ–≤–∏—Ç—å —Ä—É—á–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é

DELETE /api/project-operations/:id
- –£–¥–∞–ª–∏—Ç—å —Ä—É—á–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
```

#### 3. –ü—Ä–∞–π—Å—ã –æ–ø–µ—Ä–∞—Ü–∏–π

```
GET /api/price-lists
- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—ã

GET /api/price-lists/:id
- –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω –ø—Ä–∞–π—Å-–ª–∏—Å—Ç —Å–æ –≤—Å–µ–º–∏ –≤–µ—Ä—Å–∏—è–º–∏

POST /api/price-lists
- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–∞–π—Å-–ª–∏—Å—Ç

PATCH /api/price-lists/:id/versions/:version/activate
- –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é (—Å–º–µ—Ç–∞ –Ω–∞—á–Ω–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Ü–µ–Ω—É)

PATCH /api/price-lists/:id/versions/:version/archive
- –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)
```

#### 4. –ò–º–ø–æ—Ä—Ç –ø—Ä–∞–π—Å–∞

```
POST /api/price-imports/upload
- –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –ø—Ä–∞–π—Å–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {session_id, status, file_type, raw_data}

POST /api/price-imports/:session/set-mapping
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫
- Body: {column_mapping: {"A": "name", "B": "price"}}

POST /api/price-imports/:session/resolve-conflicts
- –†–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
- Body: {resolutions: [{row_id: 123, action: 'merge|skip'}]}

POST /api/price-imports/:session/execute
- –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç (—Å–æ–∑–¥–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Ü–µ–Ω—ã)
```

### –î–∞–Ω–Ω—ã–µ, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –º–µ–∂–¥—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –±—ç–∫–µ–Ω–¥

#### –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–π—Å–∞ (PriceImportDialog.vue)

```javascript
// –®–∞–≥ 1: –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
{
    supplier_id: 5,
    file: File,
    target_type: 'operations'  // –∏–ª–∏ 'materials'
}

// –®–∞–≥ 2: –ú–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫
{
    session_id: "uuid-xxx",
    column_mapping: {
        "A": "name",
        "B": "category",
        "C": "price_value",
        "D": "unit"
    },
    header_row_index: 1
}

// –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞
{
    session_id: "uuid-xxx",
    new_price_list: {
        name: "–ú–∞–π 2025",
        effective_date: "2025-05-01"
    }
}

// –û—Ç–≤–µ—Ç:
{
    stats: {
        items_count: 145,
        price_lists_count: 1,
        created_records: 145
    },
    result: {
        price_list_version_id: 42,
        operations_created: 145
    }
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å–º–µ—Ç–æ–π

```javascript
// 1. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç
POST /api/projects
{name: "–ö—É—Ö–Ω—è –¥–ª—è –∫–≤–∞—Ä—Ç–∏—Ä—ã"}

// 2. –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–∑–∏—Ü–∏–∏ —Å —Ç–∏–ø–∞–º–∏ –¥–µ—Ç–∞–ª–µ–π
POST /api/projects/1/positions
{
    detail_type_id: 5,      // "–ü–æ–ª–∫–∞ –õ–î–°–ü"
    material_id: 10,        // "–õ–î–°–ü —Ç–æ–ª—â–∏–Ω–∞ 18mm"
    width: 800,             // –º–º
    length: 400,
    quantity: 3
}

// 3. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏–∏
GET /api/projects/1/operations

–û—Ç–≤–µ—Ç:
[
    {
        operation_id: 1,
        name: "–†–µ–∑–∫–∞ –õ–î–°–ü",
        quantity: 1.056,    // (0.32 –º¬≤ √ó 1.1 √ó 3)
        source: "material",
        cost_per_unit: 120,
        total_cost: 126.72
    },
    {
        operation_id: 2,
        name: "–ö—Ä–æ–º–∫–∏—Ä–æ–≤–∞–Ω–∏–µ",
        quantity: 8.28,     // (2.4 √ó 1.15 √ó 3)
        source: "edge_processing",
        cost_per_unit: 50,
        total_cost: 414
    }
]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω —á–µ—Ä–µ–∑ –∏–º–ø–æ—Ä—Ç –ø—Ä–∞–π—Å–∞

```javascript
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π –ø—Ä–∞–π—Å-–ª–∏—Å—Ç
// (—Ñ–∞–π–ª Excel —Å —Ü–µ–Ω–∞–º–∏ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏)

// 2. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é PriceListVersion
POST /api/price-imports/execute
{
    session_id: "uuid-xxx",
    new_price_list: {name: "–ò—é–Ω—å 2025"}
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
{
    price_list_version_id: 43,
    status: 'active'  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
}

// 3. –í—Å–µ —Å–º–µ—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ —ç—Ç–æ—Ç –ø—Ä–∞–π—Å, 
//    –Ω–∞—á–∏–Ω–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ü–µ–Ω—ã
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä—É—á–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏

```javascript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
POST /api/projects/1/operations
{
    operation_id: 123,      // "–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —à–ª–∏—Ñ–æ–≤–∫–∞"
    quantity: 2,
    note: "–®–ª–∏—Ñ–æ–≤–∫–∞ –ø–æ–¥ –ø–æ–∫—Ä—ã—Ç–∏–µ"
}

// –ü—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ —Å–º–µ—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è:
[
    ...–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏...,
    {
        operation_id: 123,
        name: "–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —à–ª–∏—Ñ–æ–≤–∫–∞",
        quantity: 2,
        source: "manual",
        cost_per_unit: 500,
        total_cost: 1000
    }
]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω

```php
// –°–º–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –≤ –º–∞–µ
// —Å –∞–∫—Ç–∏–≤–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π v2 (—Ü–µ–Ω–∞ —Ä–µ–∑–∫–∏ 100 —Ä—É–±/–º¬≤)

// –í –∏—é–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø—Ä–∞–π—Å (–≤–µ—Ä—Å–∏—è v3)
// —Å —Ü–µ–Ω–æ–π —Ä–µ–∑–∫–∏ 120 —Ä—É–±/–º¬≤

// –í–æ–ø—Ä–æ—Å: –ö–∞–∫–∞—è —Ü–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –≤ —Å–º–µ—Ç–µ?

// –û—Ç–≤–µ—Ç: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –≤–µ—Ä—Å–∏–∏:
// $project->estimated_price_list_version_id = 2  // –í–µ—Ä—Å–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
// cost = quantity √ó price_from_v2  // 100 —Ä—É–±/–º¬≤

// –ù–æ–≤–∞—è —Å–º–µ—Ç–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å v3 (120 —Ä—É–±/–º¬≤)
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ (Vue 3 Composition API)

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **OperationsView.vue** ‚Äì –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –æ–ø–µ—Ä–∞—Ü–∏–π
   - –°–ø–∏—Å–∫–æ–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ user origin)
   - –ò–º–ø–æ—Ä—Ç –ø—Ä–∞–π—Å–æ–≤ —á–µ—Ä–µ–∑ PriceImportDialog

2. **PriceImportDialog.vue** ‚Äì –ú–∞—Å—Ç–µ—Ä –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–∞–π—Å–∞
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ (Excel, CSV, HTML)
   - –ü–∞—Ä—Å–∏–Ω–≥ –∏ –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫
   - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
   - –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞
   - –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–µ—Ä—Å–∏–∏

3. **ProjectEditorView.vue** ‚Äì –†–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞/—Å–º–µ—Ç—ã
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –¢–∞–±–ª–∏—Ü–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ (detail_type, material, edge_processing, manual)
   - –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏ —Ä–∞—Å—á–µ—Ç–∞
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä—É—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

4. **DetailTypesView.vue** ‚Äì –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞–º–∏ –¥–µ—Ç–∞–ª–µ–π
   - –°–≤—è–∑—å –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ç–∏–ø–æ–º –¥–µ—Ç–∞–ª–∏
   - –ó–∞–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (quantity_formula)

### –ë—ç–∫–µ–Ω–¥ (Laravel)

**–°–µ—Ä–≤–∏—Å—ã:**

1. **AutoOperationCalculator** ‚Äì –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π
   - –°–±–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ —Ç—Ä–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª

2. **EstimateCalculator** ‚Äì –†–∞—Å—á–µ—Ç –ø–æ–ª–Ω–æ–π —Å–º–µ—Ç—ã
   - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –∫—Ä–æ–º–∫–∏, –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

3. **PriceImportService** ‚Äì –ò–º–ø–æ—Ä—Ç –ø—Ä–∞–π—Å–æ–≤
   - –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ (Excel, CSV)
   - –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –∏ —Ü–µ–Ω
   - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

4. **EdgeProcessingService** ‚Äì –†–∞—Å—á–µ—Ç –¥–ª–∏–Ω—ã –∫—Ä–æ–º–∫–∏
   - –ü–æ —Å—Ö–µ–º–µ –∫—Ä–æ–º–∫–∏ (O, =, ||, L, –ü)
   - –° —É—á–µ—Ç–æ–º —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–æ–∑–∏—Ü–∏–∏

---

## –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- [x] –ú–æ–¥–µ–ª—å Operation —Å –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ–º (origin: system, parser, user)
- [x] ProjectManualOperation –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- [x] DetailTypeOperation —Å —Ñ–æ—Ä–º—É–ª–∞–º–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- [x] AutoOperationCalculator —Å —Ç—Ä–µ–º—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
- [x] PriceList –∏ PriceListVersion —Å –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å—é
- [x] –°—Ç–∞—Ç—É—Å—ã –≤–µ—Ä—Å–∏–∏ (inactive, active, archived)
- [x] OperationPrice –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —Ü–µ–Ω –∫ –≤–µ—Ä—Å–∏—è–º
- [x] PriceImportSession –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–æ–º
- [x] API endpoints –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –ø—Ä–∞–π—Å–æ–≤
- [x] –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (OperationsView, PriceImportDialog, etc.)
- [x] –†–∞—Å—á–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–º–µ—Ç–µ
- [x] –ì—Ä—É–ø–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏—è (exclusion_group)
- [x] –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Ç–∏–ø–∞ –¥–µ—Ç–∞–ª–∏

### üìã –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ / –£—Ç–æ—á–Ω–µ–Ω–∏–µ

- [ ] –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OperationPrice –≤ —Ä–∞—Å—á–µ—Ç—ã —Å–º–µ—Ç—ã
- [ ] History tracking –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω
- [ ] UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Ä—Å–∏–π –ø—Ä–∞–π—Å–æ–≤
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ë–∞–ª–∫-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ü–µ–Ω —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ö–∞–∫ "–∂–∏–≤—É—Ç" –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

1. **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –≤ –ø–∞–º—è—Ç–∏:**
   - –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ AutoOperationCalculator —Å–æ–±–∏—Ä–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –û–ø–µ—Ä–∞—Ü–∏–∏ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –ø–æ ID –≤ –æ–¥–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ
   - –•—Ä–∞–Ω—è—Ç—Å—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∏—Å—Ç–æ—á–Ω–∏–∫–µ (source)
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–µ—Ä—Å–∏–∏ –ø—Ä–∞–π—Å–∞:**
   - –¶–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–µ—Ä—Å–∏–∏ PriceListVersion
   - –ü—Ä–∏ —Å–º–µ–Ω–µ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—Å–µ —Å–º–µ—Ç—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è
   - –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

3. **–°–ª–æ–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏:**
   - `Operation` ‚Äì —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ (—É–Ω–∏–∫–∞–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ)
   - `ProjectManualOperation` ‚Äì –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É (—É–Ω–∏–∫–∞–ª—å–Ω–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç)
   - `OperationPrice` ‚Äì —Ü–µ–Ω–∞ –∏–∑ –≤–µ—Ä—Å–∏–∏ (–ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –≤–µ—Ä—Å–∏–∏)
   - `DetailTypeOperation` ‚Äì –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–∏–ø—É –¥–µ—Ç–∞–ª–∏ (—É–Ω–∏–∫–∞–ª—å–Ω–∞ –Ω–∞ —Ç–∏–ø)

4. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≥—Ä—É–ø–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏—è:**
   - –û–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –æ–ø–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - –°–∏—Å—Ç–µ–º–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö –ø–æ `exclusion_group`
   - –ù–µ —Å—É–º–º–∏—Ä—É–µ—Ç, –∞ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—É—é (—Å —Å–∞–º—ã–º —É–∑–∫–∏–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º —Ç–æ–ª—â–∏–Ω)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –§–µ–≤—Ä–∞–ª—å 2025  
**–í–µ—Ä—Å–∏—è:** 1.0

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=480">
  <title>–ü—Ä–∏–∑–º–∞ ‚Äî –ê–≤—Ç–æ—Å–±–æ—Ä</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div id="app">

    <!-- Header -->
    <header class="header">
      <div class="header-title">
        <span class="logo">‚óÜ</span> –ü—Ä–∏–∑–º–∞
      </div>
      <div class="header-status" id="auth-status">
        <span class="status-dot offline"></span>
        <span id="status-text">–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</span>
      </div>
    </header>

    <!-- Auth Section (shown when not authenticated) -->
    <section id="section-auth" class="section hidden">
      <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ü—Ä–∏–∑–º–µ</h2>
      <div class="form-group">
        <label for="input-api-url">–ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞</label>
        <input type="url" id="input-api-url" placeholder="https://prismcore.ru/api" value="https://prismcore.ru/api">
      </div>
      <div class="form-group">
        <label for="input-token">API –¢–æ–∫–µ–Ω</label>
        <input type="password" id="input-token" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è">
        <small class="hint">–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ü–†–ò–ó–ú–ê</small>
      </div>
      <button id="btn-connect" class="btn btn-primary btn-full">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>

      <div id="auth-error" class="error-text hidden"></div>
    </section>

    <!-- Main Section (shown when authenticated) -->
    <section id="section-main" class="section hidden">

      <!-- Page Info -->
      <div class="page-info" id="page-info">
        <div class="page-domain" id="page-domain">‚Äî</div>
        <div class="page-url" id="page-url" title="">‚Äî</div>
        <div id="page-loading-status" class="page-loading-status hidden">
          <span class="loading-bar"></span>
        </div>
        <div class="template-status" id="template-status"></div>
      </div>

      <!-- Tab Navigation -->
      <nav class="tabs">
        <button class="tab active" data-tab="capture">–ó–∞—Ö–≤–∞—Ç</button>
        <button class="tab" data-tab="template">–®–∞–±–ª–æ–Ω</button>
        <button class="tab" data-tab="settings">‚öô</button>
        <button class="tab" data-tab="about">About</button>
      </nav>

      <!-- Tab: Capture -->
      <div class="tab-content active" id="tab-capture">

        <!-- Schema.org auto-detect banner -->
        <div id="schema-banner" class="schema-banner hidden">
          <div class="schema-banner__header">
            <span class="schema-banner__icon">üîç</span>
            <span class="schema-banner__title">Schema.org –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞</span>
            <button id="btn-schema-toggle" class="btn-schema-toggle">–ü–æ–∫–∞–∑–∞—Ç—å</button>
          </div>
          <div id="schema-details" class="schema-details hidden">
            <!-- Schema selector (if multiple schemas on page) -->
            <div id="schema-selector" class="schema-selector hidden">
              <label class="schema-selector-label">–°—Ö–µ–º–∞:</label>
              <select id="schema-select" class="schema-select"></select>
            </div>
            <!-- Schema fields table with mapping dropdowns -->
            <div id="schema-fields-container" class="schema-fields-container"></div>
            <div class="schema-actions">
              <button id="btn-schema-apply" class="btn btn-primary btn-full">
                –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—è
              </button>
            </div>
          </div>
        </div>

        <div class="capture-fields">
          <div class="capture-field" data-field="title">
            <div class="field-header">
              <span class="field-label">–ù–∞–∑–≤–∞–Ω–∏–µ</span>
              <span class="field-required">*</span>
              <button class="btn-capture" data-field="title">–í—ã–±—Ä–∞—Ç—å</button>
            </div>
            <div class="field-value" id="val-title">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
          </div>

          <div class="capture-field" data-field="price">
            <div class="field-header">
              <span class="field-label">–¶–µ–Ω–∞</span>
              <span class="field-required">*</span>
              <button class="btn-capture" data-field="price">–í—ã–±—Ä–∞—Ç—å</button>
            </div>
            <div class="field-value" id="val-price">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
          </div>

          <div class="capture-field" data-field="article">
            <div class="field-header">
              <span class="field-label">–ê—Ä—Ç–∏–∫—É–ª</span>
              <button class="btn-capture" data-field="article">–í—ã–±—Ä–∞—Ç—å</button>
            </div>
            <div class="field-value" id="val-article">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
          </div>

          <div class="capture-field" data-field="thickness">
            <div class="field-header">
              <span class="field-label">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</span>
              <span class="field-required">*</span>
              <span class="field-source-badge hidden" id="badge-thickness"></span>
              <button class="btn-capture" data-field="thickness">–í—ã–±—Ä–∞—Ç—å</button>
              <button class="btn-manual-toggle" data-field="thickness" title="–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é">‚úèÔ∏è</button>
            </div>
            <div class="field-value" id="val-thickness">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
            <div class="field-manual-row hidden" id="manual-row-thickness">
              <input type="text" class="manual-input" id="manual-input-thickness" data-field="thickness" placeholder="–Ω–∞–ø—Ä. 16" inputmode="decimal">
              <button class="btn-manual-ok" data-field="thickness" title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å">‚úì</button>
              <button class="btn-manual-cancel" data-field="thickness" title="–û—Ç–º–µ–Ω–∞">‚úó</button>
            </div>
          </div>

          <div class="capture-field" data-field="length">
            <div class="field-header">
              <span class="field-label">–î–ª–∏–Ω–∞ (–º–º)</span>
              <span class="field-required">*</span>
              <span class="field-source-badge hidden" id="badge-length"></span>
              <button class="btn-capture" data-field="length">–í—ã–±—Ä–∞—Ç—å</button>
              <button class="btn-manual-toggle" data-field="length" title="–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é">‚úèÔ∏è</button>
            </div>
            <div class="field-value" id="val-length">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
            <div class="field-manual-row hidden" id="manual-row-length">
              <input type="text" class="manual-input" id="manual-input-length" data-field="length" placeholder="–Ω–∞–ø—Ä. 2750" inputmode="decimal">
              <button class="btn-manual-ok" data-field="length" title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å">‚úì</button>
              <button class="btn-manual-cancel" data-field="length" title="–û—Ç–º–µ–Ω–∞">‚úó</button>
            </div>
          </div>

          <div class="capture-field" data-field="width">
            <div class="field-header">
              <span class="field-label">–®–∏—Ä–∏–Ω–∞ (–º–º)</span>
              <span class="field-required">*</span>
              <span class="field-source-badge hidden" id="badge-width"></span>
              <button class="btn-capture" data-field="width">–í—ã–±—Ä–∞—Ç—å</button>
              <button class="btn-manual-toggle" data-field="width" title="–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é">‚úèÔ∏è</button>
            </div>
            <div class="field-value" id="val-width">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
            <div class="field-manual-row hidden" id="manual-row-width">
              <input type="text" class="manual-input" id="manual-input-width" data-field="width" placeholder="–Ω–∞–ø—Ä. 1830" inputmode="decimal">
              <button class="btn-manual-ok" data-field="width" title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å">‚úì</button>
              <button class="btn-manual-cancel" data-field="width" title="–û—Ç–º–µ–Ω–∞">‚úó</button>
            </div>
          </div>
        </div>

        <!-- Validation Preview -->
        <div id="validation-preview" class="validation-preview hidden">
          <h3>–ü—Ä–µ–≤—å—é</h3>
          <div id="preview-content"></div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button id="btn-validate" class="btn btn-secondary" disabled>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
          <button id="btn-add-material" class="btn btn-primary" disabled>–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—Ä–∏–∑–º—É</button>
        </div>

        <div id="capture-result" class="result-message hidden"></div>

        <button id="btn-clear" class="btn btn-link">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ø–æ–ª—è</button>
      </div>

      <!-- Tab: Template -->
      <div class="tab-content" id="tab-template">
        <div class="template-section">
          <h3>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω</h3>
          <p class="hint">–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –ø–æ–∑–≤–æ–ª—è—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Å–µ—â–µ–Ω–∏–∏.</p>

          <div class="form-group">
            <label for="template-name">–ò–º—è —à–∞–±–ª–æ–Ω–∞</label>
            <input type="text" id="template-name" placeholder="Ozon product page v1">
          </div>

          <div class="form-group">
            <label>–ü—Ä–∏–º–µ–Ω—è—Ç—å –¥–ª—è</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="url-scope" value="domain" checked>
                –í–µ—Å—å –¥–æ–º–µ–Ω
              </label>
              <label class="radio-label">
                <input type="radio" name="url-scope" value="pattern">
                –¢–æ–ª—å–∫–æ URL-–ø–∞—Ç—Ç–µ—Ä–Ω
              </label>
            </div>
            <input type="text" id="url-pattern" class="hidden" placeholder="/product/ –∏–ª–∏ regex">
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="template-default">
              –®–∞–±–ª–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –¥–æ–º–µ–Ω–∞
            </label>
          </div>

          <button id="btn-save-template" class="btn btn-primary btn-full" disabled>
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω
          </button>
          <div id="template-save-result" class="result-message hidden"></div>
        </div>

        <hr>

        <div class="template-section">
          <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —à–∞–±–ª–æ–Ω—ã</h3>
          <div id="templates-list" class="templates-list">
            <p class="hint">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
          </div>
        </div>

        <hr>

        <div class="template-section">
          <h3>–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
          <p class="hint">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –∫ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.</p>
          <button id="btn-apply-template" class="btn btn-secondary btn-full" disabled>
            –ü—Ä–∏–º–µ–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω
          </button>
          <div id="apply-result" class="result-message hidden"></div>
        </div>
      </div>

      <!-- Tab: Settings -->
      <div class="tab-content" id="tab-settings">
        <div class="settings-section">
          <h3>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h3>
          <div class="info-row">
            <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</span>
            <strong id="settings-user-name">‚Äî</strong>
          </div>
          <div class="info-row">
            <span>Email:</span>
            <strong id="settings-user-email">‚Äî</strong>
          </div>
          <div class="info-row">
            <span>–†–µ–≥–∏–æ–Ω:</span>
            <strong id="settings-region">‚Äî</strong>
          </div>
          <div class="info-row">
            <span>–°–µ—Ä–≤–µ—Ä:</span>
            <strong id="settings-server-url">‚Äî</strong>
          </div>
          <button id="btn-disconnect" class="btn btn-danger btn-full">–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
        </div>
      </div>

      <!-- Tab: About -->
      <div class="tab-content" id="tab-about">
        <div class="settings-section">
          <h3>–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h3>
          <p class="hint">
            –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥–µ—Ñ–µ–∫—Ç–æ–≤ –ü–†–ò–ó–ú–ê
          </p>
          <a
            href="https://prismcore.ru"
            target="_blank"
            rel="noopener noreferrer"
            class="btn btn-secondary btn-full"
            id="btn-open-prism-site"
          >
            –û—Ç–∫—Ä—ã—Ç—å prismcore.ru
          </a>
        </div>
      </div>

    </section>

  </div>

  <script src="popup.js"></script>
</body>
</html>
